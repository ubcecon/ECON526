<!DOCTYPE html>
<html lang="en"><head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/tabby.min.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.5.57">

  <meta name="author" content="Paul Schrimpf">
  <title>ECON 526 – Double / Debiased Machine Learning</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
    /* CSS for citations */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
      margin-bottom: 0em;
    }
    .hanging-indent div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }  </style>
  <link rel="stylesheet" href="site_libs/revealjs/dist/theme/quarto.css">
  <link href="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="green.jpg" data-background-size="contain" class="quarto-title-block center">
  <h1 class="title">Double / Debiased Machine Learning</h1>
  <p class="subtitle">ECON526</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Paul Schrimpf 
</div>
        <p class="quarto-title-affiliation">
            University of British Columbia
          </p>
    </div>
</div>

</section><section id="TOC">
<nav role="doc-toc"> 
<h2 id="toc-title">Table of contents</h2>
<ul>
<li><a href="#/introduction" id="/toc-introduction">Introduction</a></li>
<li><a href="#/theory" id="/toc-theory">Theory</a></li>
<li><a href="#/creating-orthogonal-moments" id="/toc-creating-orthogonal-moments">Creating Orthogonal Moments</a></li>
<li><a href="#/example-gender-wage-gap" id="/toc-example-gender-wage-gap">Example: Gender Wage Gap</a></li>
</ul>
</nav>
</section>
<section>
<section id="introduction" class="title-slide slide level1 center">
<h1>Introduction</h1>
<p><span class="math display">\[
\def\indep{\perp\!\!\!\perp}
\def\Er{\mathrm{E}}
\def\R{\mathbb{R}}
\def\En{{\mathbb{E}_n}}
\def\Pr{\mathrm{P}}
\newcommand{\norm}[1]{\left\Vert {#1} \right\Vert}
\newcommand{\abs}[1]{\left\vert {#1} \right\vert}
\def\inprob{{\,{\buildrel p \over \rightarrow}\,}}
\def\indist{\,{\buildrel d \over \rightarrow}\,}
\DeclareMathOperator*{\plim}{plim}
\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}
\]</span></p>
</section>
<section id="introduction-1" class="slide level2">
<h2>Introduction</h2>
<ul>
<li>Many estimation tasks involve:
<ul>
<li>Low dimensional parameter of interest</li>
<li>High dimensional nuisance parameters needed to recover parameter of interest</li>
</ul></li>
<li>Example: in <a href="./matching.html">matching</a>
<ul>
<li>Interested in <span class="math inline">\(ATE = \Er[Y(1) - Y(0)]\)</span></li>
<li>Nuisance parameters <span class="math inline">\(\Er[Y|D,X]\)</span> and/or <span class="math inline">\(P(D=1|X)\)</span></li>
</ul></li>
</ul>
</section>
<section id="machine-learning-for-nuisance-parameters" class="slide level2">
<h2>Machine Learning for Nuisance Parameters</h2>
<ul>
<li><p>In <a href="./matching.html">matching</a> we said that we could use flexible machine learning estimators for <span class="math inline">\(\Er[Y|D,X]\)</span> and <span class="math inline">\(P(D=1|X)\)</span> and plug them into the doubly robust estimator</p></li>
<li><p>We will cover:</p>
<ul>
<li>Some of the technical details behind this idea</li>
<li>How this idea can be applied to other estimators</li>
</ul></li>
</ul>
<aside class="notes">
<p>These notes will examine the incorportion of machine learning methods in classic econometric techniques for estimating causal effects. More specifally, we will focus on estimating treatment effects using matching and instrumental variables. In these estimators (and many others) there is a low-dimensional parameter of interest, such as the average treatment effect, but estimating it requires also estimating a potentially high dimensional nuisance parameter, such as the propensity score. Machine learning methods were developed for prediction with high dimensional data. It is then natural to try to use machine learning for estimating high dimensional nuisance parameters. Care must be taken when doing so though because the flexibility and complexity that make machine learning so good at prediction also pose challenges for inference.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="example-partially-linear-model" class="slide level2">
<h2>Example: partially linear model</h2>
<p><span class="math display">\[
    y_i = \theta d_i + f(x_i) + \epsilon_i
\]</span></p>
<ul>
<li>Interested in <span class="math inline">\(\theta\)</span></li>
<li>Assume <span class="math inline">\(\Er[\epsilon|d,x] = 0\)</span></li>
<li>Nuisance parameter <span class="math inline">\(f()\)</span></li>
</ul>
</section>
<section id="example-matching" class="slide level2">
<h2>Example: Matching</h2>
<ul>
<li>Binary treatment <span class="math inline">\(d_i \in \{0,1\}\)</span></li>
<li>Potential outcomes <span class="math inline">\(y_i(0), y_i(1)\)</span>, observe <span class="math inline">\(y_i = y_i(d_i)\)</span></li>
<li>Interested in average treatment effect : <span class="math inline">\(\theta = \Er[y_i(1) -
y_i(0)]\)</span></li>
<li>Covariates <span class="math inline">\(x_i\)</span></li>
<li>Assume unconfoundedness : <span class="math inline">\(d_i \indep y_i(1), y_i(0) | x_i\)</span></li>
</ul>
<aside class="notes">
<p>The partially linear and matching models are closely related. If the conditional mean independence assumption of the partially linear model is strengthing to conditional indepence then the partially linear model is a special case of the matching model with constant treatment effects, <span class="math inline">\(y_i(1) - y_i(0) = \theta\)</span>. Thus the matching model can be viewed as a generalization of the partially linear model that allows for treatment effect heterogeneity.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="example-matching-1" class="slide level2">
<h2>Example: Matching</h2>
<ul>
<li>Estimatable formulae for ATE : <span class="math display">\[
\begin{align*}
\theta = &amp; \Er\left[\frac{y_i d_i}{\Pr(d = 1 | x_i)} - \frac{y_i
    (1-d_i)}{1-\Pr(d=1|x_i)} \right] \\
\theta = &amp; \Er\left[\Er[y_i | d_i = 1, x_i] - \Er[y_i | d_i = 0 , x_i]\right] \\
\theta = &amp; \Er\left[ \begin{array}{l} d_i \frac{y_i - \Er[y_i | d_i = 1,
    x_i]}{\Pr(d=1|x_i)} - (1-d_i)\frac{y_i - \Er[y_i | d_i = 0,
    x_i]}{1-\Pr(d=1|x_i)} + \\ + \Er[y_i | d_i = 1, x_i] - \Er[y_i | d_i = 0 ,
    x_i]\end{array}\right]
\end{align*}
\]</span></li>
</ul>
</section>
<section id="example-iv" class="slide level2">
<h2>Example: IV</h2>
<p><span class="math display">\[
\begin{align*}
y_i = &amp; \theta d_i + f(x_i) + \epsilon_i \\
d_i = &amp; g(x_i, z_i) + u_i
\end{align*}
\]</span></p>
<ul>
<li>Interested in <span class="math inline">\(\theta\)</span></li>
<li>Assume <span class="math inline">\(\Er[\epsilon|x,z] = 0\)</span>, <span class="math inline">\(\Er[u|x,z]=0\)</span></li>
<li>Nuisance parameters <span class="math inline">\(f()\)</span>, <span class="math inline">\(g()\)</span></li>
</ul>
</section>
<section id="example-late" class="slide level2">
<h2>Example: LATE</h2>
<ul>
<li>Binary instrumet <span class="math inline">\(z_i \in \{0,1\}\)</span></li>
<li>Potential treatments <span class="math inline">\(d_i(0), d_i(1) \in \{0,1\}\)</span>, <span class="math inline">\(d_i = d_i(Z_i)\)</span></li>
<li>Potential outcomes <span class="math inline">\(y_i(0), y_i(1)\)</span>, observe <span class="math inline">\(y_i = y_i(d_i)\)</span></li>
<li>Covariates <span class="math inline">\(x_i\)</span></li>
<li><span class="math inline">\((y_i(1), y_i(0), d_i(1), d_i(0)) \indep z_i | x_i\)</span></li>
<li>Local average treatment effect: <span class="math display">\[
\begin{align*}
\theta = &amp; \Er\left[\Er[y_i(1) - y_i(0) | x, d_i(1) &gt; d_i(0)]\right] \\
     = &amp; \Er\left[\frac{\Er[y|z=1,x] - \Er[y|z=0,x]}
                    {\Er[d|z=1,x]-\Er[d|z=0,x]} \right]
\end{align*}
\]</span></li>
</ul>
</section></section>
<section>
<section id="theory" class="title-slide slide level1 center">
<h1>Theory</h1>

</section>
<section id="general-setup" class="slide level2">
<h2>General setup</h2>
<ul>
<li><p>Parameter of interest <span class="math inline">\(\theta \in \R^{d_\theta}\)</span></p></li>
<li><p>Nuisance parameter <span class="math inline">\(\eta \in T\)</span></p></li>
<li><p>Moment conditions <span class="math display">\[
\Er[\psi(W;\theta_0,\eta_0) ] = 0 \in \R^{d_\theta}
\]</span> with <span class="math inline">\(\psi\)</span> known</p></li>
<li><p>Estimate <span class="math inline">\(\hat{\eta}\)</span> using some machine learning method</p></li>
<li><p>Estimate <span class="math inline">\(\hat{\theta}\)</span> from <span class="math display">\[
\En[\psi(w_i;\hat{\theta},\hat{\eta}) ] = 0
\]</span></p></li>
</ul>
<aside class="notes">
<p>We are following the setup and notation of <span class="citation" data-cites="chernozhukov2018">Chernozhukov et al. (<a href="#/references" role="doc-biblioref" onclick="">2018</a>)</span>. As in the examples, the dimension of <span class="math inline">\(\theta\)</span> is fixed and small. The dimension of <span class="math inline">\(\eta\)</span> is large and might be increasing with sample size. <span class="math inline">\(T\)</span> is some normed vector space.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="example-partially-linear-model-1" class="slide level2">
<h2>Example: partially linear model</h2>
<p><span class="math display">\[
    y_i = \theta_0 d_i + f_0(x_i) + \epsilon_i
\]</span></p>
<ul>
<li><p>Compare the estimates from</p>
<ol type="1">
<li><span class="math inline">\(\En[d_i(y_i - \tilde{\theta} d_i - \hat{f}(x_i)) ] = 0\)</span></li>
</ol>
<p>and</p>
<ol start="2" type="1">
<li><span class="math inline">\(\En[(d_i - \hat{m}(x_i))(y_i - \hat{\mu}(x_i) -  \theta (d_i - \hat{m}(x_i)))] = 0\)</span></li>
</ol>
<p>where <span class="math inline">\(m(x) = \Er[d|x]\)</span> and <span class="math inline">\(\mu(y) = \Er[y|x]\)</span></p></li>
</ul>
<aside class="notes">
<p><strong>Example: partially linear model</strong> In the partially linear model,</p>
<p><span class="math display">\[
    y_i = \theta_0 d_i + f_0(x_i) + \epsilon_i
\]</span></p>
<p>we can let <span class="math inline">\(w_i = (y_i, x_i)\)</span> and <span class="math inline">\(\eta = f\)</span>. There are a variety of candidates for <span class="math inline">\(\psi\)</span>. An obvious (but flawed) one is <span class="math inline">\(\psi(w_i; \theta,
\eta) = (y_i - \theta_0 d_i - f_0(x_i))d_i\)</span>. With this choice of <span class="math inline">\(\psi\)</span>, we have</p>
<p><span class="math display">\[
\begin{align*}
0 = &amp; \En[d_i(y_i - \hat{\theta} d_i - \hat{f}(x_i)) ] \\
\hat{\theta} = &amp; \En[d_i^2]^{-1} \En[d_i (y_i - \hat{f}(x_i))] \\
(\hat{\theta} - \theta_0) = &amp;  \En[d_i^2]^{-1} \En[d_i \epsilon_i] +
    \En[d_i^2]^{-1} \En[d_i (f_0(x_i) - \hat{f}(x_i))]
\end{align*}
\]</span></p>
<p>The first term of this expression is quite promising. <span class="math inline">\(d_i\)</span> and <span class="math inline">\(\epsilon_i\)</span> are both finite dimensional random variables, so a law of large numbers will apply to <span class="math inline">\(\En[d_i^2]\)</span>, and a central limit theorem would apply to <span class="math inline">\(\sqrt{n} \En[d_i \epsilon_i]\)</span>. Unfortunately, the second expression is problematic. To accomodate high dimensional <span class="math inline">\(x\)</span> and allow for flexible <span class="math inline">\(f()\)</span>, machine learning estimators must introduce some sort of regularization to control variance. This regularization also introduces some bias. The bias generally vanishes, but at a slower than <span class="math inline">\(\sqrt{n}\)</span> rate. Hence</p>
<p><span class="math display">\[
\sqrt{n} \En[d_i (f_0(x_i) - \hat{f}(x_i))] \to \infty.
\]</span></p>
<p>To get around this problem, we must modify our estimate of <span class="math inline">\(\theta\)</span>. Let <span class="math inline">\(m(x) = \Er[d|x]\)</span> and <span class="math inline">\(\mu(y) = \Er[y|x]\)</span>. Let <span class="math inline">\(\hat{m}()\)</span> and <span class="math inline">\(\hat{\mu}()\)</span> be some estimates. Then we can estimate <span class="math inline">\(\theta\)</span> by partialling out:</p>
<p><span class="math display">\[
\begin{align*}
0 = &amp; \En[(d_i - \hat{m}(x_i))(y_i - \hat{\mu}(x_i) -  \theta (d_i - \hat{m}(x_i)))] \\
\hat{\theta} = &amp; \En[(d_i -\hat{m}(x_i))^2]^{-1} \En[(d_i -
\hat{m}(x_i))(y_i - \hat{\mu}(x_i))] \\
(\hat{\theta} - \theta_0) = &amp; \En[(d_i -\hat{m}(x_i))^2]^{-1} \left(\En[(d_i -
\hat{m}(x_i))\epsilon_i] + \En[(d_i - \hat{m}(x_i))(\mu(x_i) -
\hat{\mu}(x_i))] \right) \\
= &amp; \En[(d_i -\hat{m}(x_i))^2]^{-1} \left( a + b +c + d \right)
\end{align*}
\]</span></p>
<p>where</p>
<p><span class="math display">\[
\begin{align*}
a = &amp; \En[(d_i -m(x_i))\epsilon_i] \\
b = &amp; \En[(m(x_i)-\hat{m}(x_i))\epsilon_i] \\
c = &amp; \En[v_i(\mu(x_i) - \hat{\mu}(x_i))] \\
d = &amp; \En[(m(x_i) - \hat{m}(x_i))(\mu(x_i) - \hat{\mu}(x_i))]
\end{align*}
\]</span></p>
<p>with <span class="math inline">\(v_i = d_i - \Er[d_i | x_i]\)</span>. The term <span class="math inline">\(a\)</span> is well behaved and <span class="math inline">\(\sqrt{n}a \leadsto N(0,\Sigma)\)</span> under standard conditions. Although terms <span class="math inline">\(b\)</span> and <span class="math inline">\(c\)</span> appear similar to the problematic term in the initial estimator, they are better behaved because <span class="math inline">\(\Er[v|x] = 0\)</span> and <span class="math inline">\(\Er[\epsilon|x] = 0\)</span>. This makes it possible, but difficult to show that <span class="math inline">\(\sqrt{n}b \to_p = 0\)</span> and <span class="math inline">\(\sqrt{n} c \to_p = 0\)</span>, see e.g. <span class="citation" data-cites="belloni2014">Belloni, Chernozhukov, and Hansen (<a href="#/references" role="doc-biblioref" onclick="">2014</a>)</span>. However, the conditions on <span class="math inline">\(\hat{m}\)</span> and <span class="math inline">\(\hat{\mu}\)</span> needed to show this are slightly restrictive, and appropriate conditions might not be known for all estimators. <span class="citation" data-cites="chernozhukov2018">Chernozhukov et al. (<a href="#/references" role="doc-biblioref" onclick="">2018</a>)</span> describe a sample splitting modification to <span class="math inline">\(\hat{\theta}\)</span> that allows <span class="math inline">\(\sqrt{n} b\)</span> and <span class="math inline">\(\sqrt{n} c\)</span> to vanish under weaker conditions (essentially the same rate condition as needed for <span class="math inline">\(\sqrt{n} d\)</span> to vanish.)</p>
<p>The last term, <span class="math inline">\(d\)</span>, is a considerable improvement upon the first estimator. Instead of involving the error in one estimate, it now involes the product of the error in two estimates. By the Cauchy-Schwarz inequality, <span class="math display">\[
d \leq \sqrt{\En[(m(x_i) - \hat{m}(x_i))^2]} \sqrt{\En[(\mu(x_i) - \hat{\mu}(x_i))^2]}.
\]</span> So if the estimates of <span class="math inline">\(m\)</span> and <span class="math inline">\(\mu\)</span> converge at rates faster than <span class="math inline">\(n^{-1/4}\)</span>, then <span class="math inline">\(\sqrt{n} d \to_p 0\)</span>. This <span class="math inline">\(n^{-1/4}\)</span> rate is reached by many machine learning estimators.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="lessons-from-the-example" class="slide level2">
<h2>Lessons from the example</h2>
<ul>
<li><p>Need an extra condition on moments – Neyman orthogonality <span class="math display">\[
\partial \eta \Er[\psi(W;\theta_0,\eta_0)](\eta-\eta_0) = 0
\]</span></p></li>
<li><p>Want estimators faster than <span class="math inline">\(n^{-1/4}\)</span> in the prediction norm, <span class="math display">\[
\sqrt{\En[(\hat{\eta}(x_i) - \eta(x_i))^2]} \lesssim_P n^{-1/4}
\]</span></p></li>
<li><p>Also want estimators that satisfy something like <span class="math display">\[ \sqrt{n} \En[(\eta(x_i)-\hat{\eta}(x_i))\epsilon_i] = o_p(1) \]</span></p>
<ul>
<li>Sample splitting / cross-fitting will make this easier</li>
</ul></li>
</ul>
</section>
<section id="cross-fitting" class="slide level2">
<h2>Cross-fitting</h2>
<ul>
<li>Randomly partition into <span class="math inline">\(K\)</span> subsets <span class="math inline">\((I_k)_{k=1}^K\)</span></li>
<li><span class="math inline">\(I^c_k = \{1, ..., n\} \setminus I_k\)</span></li>
<li><span class="math inline">\(\hat{\eta}_k =\)</span> estimate of <span class="math inline">\(\eta\)</span> using <span class="math inline">\(I^c_k\)</span></li>
<li>Estimator: <span class="math display">\[
\begin{align*}
0 = &amp; \frac{1}{K} \sum_{k=1}^K \frac{K}{n} \sum_{i \in I_k}
\psi(w_i;\hat{\theta}^{DML},\hat{\eta}_k) \\
0 = &amp; \frac{1}{K} \sum_{k=1}^K \En_k[
\psi(w_i;\hat{\theta}^{DML},\hat{\eta}_k)]
\end{align*}
\]</span></li>
</ul>
</section>
<section id="assumptions" class="slide level2">
<h2>Assumptions</h2>
<ol type="1">
<li>Neyman Orthogonality <span class="math display">\[
\partial \eta \Er[\psi(W;\theta_0,\eta_0)](\eta-\eta_0) \approx 0
\]</span></li>
<li>Fast enough convergence of <span class="math inline">\(\hat{\eta}\)</span> <span class="math display">\[
\sqrt{\Er[(\hat{\eta}_k(x_i) - \eta(x_i))^2|I_k^c]} \lesssim_P n^{-1/4}
\]</span></li>
<li>Various moments exist and other regularity conditions</li>
<li>Moment condition linear in <span class="math inline">\(\theta\)</span> (to simplify notation only) <span class="math display">\[
\psi(w;\theta,\eta) = \psi^a(w;\eta) \theta + \psi^b(w;\eta)
\]</span></li>
</ol>
<p><sup>1</sup></p>
<aside><ol class="aside-footnotes"><li id="fn1"><p>These are stated loosely, see <span class="citation" data-cites="chernozhukov2018">Chernozhukov et al. (<a href="#/references" role="doc-biblioref" onclick="">2018</a>)</span> for precise conditions.</p></li></ol></aside></section>
<section id="asymptotic-normality" class="slide level2">
<h2>Asymptotic Normality</h2>
<p><span class="math display">\[
\sqrt{n} \sigma^{-1} (\hat{\theta} - \theta_0) = \frac{1}{\sqrt{n}}
\sum_{i=1}^n \bar{\psi}(w_i) + o_p(1) \indist N(0,1)
\]</span> - Variance <span class="math display">\[\sigma^2 = \Er[\psi^a(w_i;\eta_0)]^{-1}  \Er\left[ \psi(w;\theta_0,\eta_0)
  \psi(w;\theta_0,\eta_0)'\right]  \Er[\psi^a(w_i;\eta_0)]^{-1}
\]</span> - Influence function <span class="math display">\[\bar{\psi}(w) = -\sigma^{-1} \Er[\psi^a(w_i;\eta_0)]^{-1} \psi(w;\theta_0,\eta_0)\]</span></p>
</section></section>
<section>
<section id="creating-orthogonal-moments" class="title-slide slide level1 center">
<h1>Creating Orthogonal Moments</h1>

</section>
<section id="creating-orthogonal-moments-1" class="slide level2">
<h2>Creating orthogonal moments</h2>
<ul>
<li><p>Need <span class="math display">\[
\partial \eta\Er\left[\psi(W;\theta_0,\eta_0)[\eta-\eta_0] \right]  \approx 0
\]</span></p></li>
<li><p>Given an some model, how do we find a suitable <span class="math inline">\(\psi\)</span>?</p></li>
<li><p>Related to finding the efficient influence function, see <span class="citation" data-cites="hines2022">Oliver Hines and Vansteelandt (<a href="#/references" role="doc-biblioref" onclick="">2022</a>)</span></p></li>
</ul>
</section>
<section id="orthogonal-scores-via-concentrating-out" class="slide level2">
<h2>Orthogonal scores via concentrating-out</h2>
<ul>
<li>Original model: <span class="math display">\[
(\theta_0, \beta_0) = \argmax_{\theta, \beta} \Er[\ell(W;\theta,\beta)]
\]</span></li>
<li>Define <span class="math display">\[
\eta(\theta) = \beta(\theta) = \argmax_\beta \Er[\ell(W;\theta,\beta)]
\]</span></li>
<li>First order condition from <span class="math inline">\(\max_\theta
\Er[\ell(W;\theta,\beta(\theta))]\)</span> is <span class="math display">\[
0 = \Er\left[ \underbrace{\frac{\partial \ell}{\partial \theta} + \frac{\partial \ell}{\partial \beta} \frac{d \beta}{d \theta}}_{\psi(W;\theta,\beta(\theta))} \right]
\]</span></li>
</ul>
</section>
<section id="example-average-derivative" class="slide level2">
<h2>Example: average derivative</h2>
<ul>
<li><p><span class="math inline">\(x,y \in \R^1\)</span>, <span class="math inline">\(\Er[y|x] = f_0(x)\)</span>, <span class="math inline">\(p(x) =\)</span> density of <span class="math inline">\(x\)</span></p></li>
<li><p><span class="math inline">\(\theta_0 = \Er[f_0'(x)]\)</span></p></li>
<li><p>Joint objective <span class="math display">\[
\min_{\theta,f} \Er\left[ (y - f(x))^2 + (\theta - f'(x)^2) \right]
\]</span></p></li>
<li><p>Solve for minimizing <span class="math inline">\(f\)</span> given <span class="math inline">\(\theta\)</span> <span class="math display">\[
f_\theta(x) = \Er[y|x] - \theta \partial_x \log p(x) + f''(x) + f'(x) \partial_x \log p(x)
\]</span></p></li>
</ul>
</section>
<section id="example-average-derivative-1" class="slide level2">
<h2>Example: average derivative</h2>
<ul>
<li><p>Concentrated objective: <span class="math display">\[
\min_\theta \Er\left[ (y - f_\theta(x))^2 + (\theta - f_\theta'(x)^2)
\right]
\]</span></p></li>
<li><p>First order condition at <span class="math inline">\(f_\theta = f_0\)</span> gives <span class="math display">\[
0 = \Er\left[ (y - f_0(x))\partial_x \log p(x) + (\theta - f_0'(x)) \right]
\]</span></p></li>
</ul>
</section>
<section id="orthogonal-scores-via-two-other-methods" class="slide level2">
<h2>Orthogonal scores via Two Other Methods</h2>
<ul>
<li><p>“Orthogonal” suggests ideas from linear algebra will useful, and they are</p></li>
<li><p>Projection: take orthogonal to <span class="math inline">\(\eta_0\)</span> projection of moments</p></li>
<li><p>Riesz representer</p></li>
</ul>
<aside class="notes">
<p><span class="citation" data-cites="chernozhukov2018">Chernozhukov et al. (<a href="#/references" role="doc-biblioref" onclick="">2018</a>)</span> show how to construct orthogonal scores in a few examples via concentrating out and projection. <span class="citation" data-cites="chernozhukov2015">Chernozhukov, Hansen, and Spindler (<a href="#/references" role="doc-biblioref" onclick="">2015</a>)</span> also discusses creating orthogonal scores.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="example-gender-wage-gap" class="title-slide slide level1 center">
<h1>Example: Gender Wage Gap</h1>

</section>
<section id="data" class="slide level2">
<h2>Data</h2>
<div id="40d80256" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>imports</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-2"><a></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a></a></span>
<span id="cb1-5"><a></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_predict</span>
<span id="cb1-6"><a></a><span class="im">from</span> sklearn <span class="im">import</span> linear_model</span>
<span id="cb1-7"><a></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> PolynomialFeatures</span>
<span id="cb1-8"><a></a><span class="im">import</span> statsmodels <span class="im">as</span> sm</span>
<span id="cb1-9"><a></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb1-10"><a></a><span class="im">from</span> statsmodels.iolib.summary2 <span class="im">import</span> summary_col</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="b0f6c50f" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a></a>cpsall <span class="op">=</span> pd.read_stata(<span class="st">"https://www.nber.org/morg/annual/morg20.dta"</span>)</span>
<span id="cb2-2"><a></a><span class="co"># take subset of data just to reduce computation time</span></span>
<span id="cb2-3"><a></a>cps <span class="op">=</span> cpsall.sample(<span class="dv">30000</span>, replace<span class="op">=</span><span class="va">False</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb2-4"><a></a>cps.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">hurespli</th>
<th data-quarto-table-cell-role="th">hhnum</th>
<th data-quarto-table-cell-role="th">county</th>
<th data-quarto-table-cell-role="th">centcity</th>
<th data-quarto-table-cell-role="th">smsastat</th>
<th data-quarto-table-cell-role="th">icntcity</th>
<th data-quarto-table-cell-role="th">smsa04</th>
<th data-quarto-table-cell-role="th">relref95</th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">spouse</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">recnum</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">ym_file</th>
<th data-quarto-table-cell-role="th">ym</th>
<th data-quarto-table-cell-role="th">ch02</th>
<th data-quarto-table-cell-role="th">ch35</th>
<th data-quarto-table-cell-role="th">ch613</th>
<th data-quarto-table-cell-role="th">ch1417</th>
<th data-quarto-table-cell-role="th">ch05</th>
<th data-quarto-table-cell-role="th">ihigrdc</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>29998.000000</td>
<td>30000.000000</td>
<td>30000.000000</td>
<td>24785.000000</td>
<td>29699.000000</td>
<td>3775.000000</td>
<td>30000.000000</td>
<td>30000.000000</td>
<td>30000.000000</td>
<td>15421.000000</td>
<td>...</td>
<td>30000.000000</td>
<td>30000.0</td>
<td>30000.000000</td>
<td>30000.000000</td>
<td>30000.000000</td>
<td>30000.000000</td>
<td>30000.000000</td>
<td>30000.000000</td>
<td>30000.000000</td>
<td>20929.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>1.248017</td>
<td>1.050267</td>
<td>25.579267</td>
<td>1.926811</td>
<td>1.186942</td>
<td>1.399735</td>
<td>3.691300</td>
<td>42.792200</td>
<td>48.781800</td>
<td>1.574347</td>
<td>...</td>
<td>200364.281250</td>
<td>2020.0</td>
<td>725.461367</td>
<td>716.238567</td>
<td>0.053967</td>
<td>0.064967</td>
<td>0.136967</td>
<td>0.081267</td>
<td>0.099833</td>
<td>12.443547</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>0.617033</td>
<td>0.238765</td>
<td>61.435104</td>
<td>0.718238</td>
<td>0.389872</td>
<td>0.987978</td>
<td>2.592906</td>
<td>3.830515</td>
<td>18.922986</td>
<td>0.675013</td>
<td>...</td>
<td>116372.054688</td>
<td>0.0</td>
<td>3.498569</td>
<td>6.903731</td>
<td>0.225956</td>
<td>0.246471</td>
<td>0.343818</td>
<td>0.273249</td>
<td>0.299783</td>
<td>2.441900</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>0.000000</td>
<td>1.000000</td>
<td>0.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>0.000000</td>
<td>40.000000</td>
<td>16.000000</td>
<td>1.000000</td>
<td>...</td>
<td>23.000000</td>
<td>2020.0</td>
<td>720.000000</td>
<td>705.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>1.000000</td>
<td>1.000000</td>
<td>0.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>0.000000</td>
<td>40.000000</td>
<td>33.000000</td>
<td>1.000000</td>
<td>...</td>
<td>98957.250000</td>
<td>2020.0</td>
<td>722.000000</td>
<td>710.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>12.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>1.000000</td>
<td>1.000000</td>
<td>0.000000</td>
<td>2.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>4.000000</td>
<td>41.000000</td>
<td>49.000000</td>
<td>2.000000</td>
<td>...</td>
<td>200032.500000</td>
<td>2020.0</td>
<td>725.000000</td>
<td>716.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>12.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>1.000000</td>
<td>1.000000</td>
<td>27.000000</td>
<td>2.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>6.000000</td>
<td>42.000000</td>
<td>64.000000</td>
<td>2.000000</td>
<td>...</td>
<td>302111.750000</td>
<td>2020.0</td>
<td>729.000000</td>
<td>722.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>14.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>13.000000</td>
<td>4.000000</td>
<td>810.000000</td>
<td>3.000000</td>
<td>2.000000</td>
<td>7.000000</td>
<td>7.000000</td>
<td>59.000000</td>
<td>85.000000</td>
<td>9.000000</td>
<td>...</td>
<td>401132.000000</td>
<td>2020.0</td>
<td>731.000000</td>
<td>728.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>18.000000</td>
</tr>
</tbody>
</table>

<p>8 rows × 55 columns</p>
</div>
</div>
</div>
</section>
<section id="partial-linear-model" class="slide level2">
<h2>Partial Linear Model</h2>
<div id="796d0c2a" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a></a><span class="kw">def</span> partial_linear(y, d, X, yestimator, destimator, folds<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb3-2"><a></a>    <span class="co">"""Estimate the partially linear model y = d*C + f(x) + e</span></span>
<span id="cb3-3"><a></a></span>
<span id="cb3-4"><a></a><span class="co">    Parameters</span></span>
<span id="cb3-5"><a></a><span class="co">    ----------</span></span>
<span id="cb3-6"><a></a><span class="co">    y : array_like</span></span>
<span id="cb3-7"><a></a><span class="co">        vector of outcomes</span></span>
<span id="cb3-8"><a></a><span class="co">    d : array_like</span></span>
<span id="cb3-9"><a></a><span class="co">        vector or matrix of regressors of interest</span></span>
<span id="cb3-10"><a></a><span class="co">    X : array_like</span></span>
<span id="cb3-11"><a></a><span class="co">        matrix of controls</span></span>
<span id="cb3-12"><a></a><span class="co">    mlestimate : Estimator object for partialling out X. Must have ‘fit’</span></span>
<span id="cb3-13"><a></a><span class="co">        and ‘predict’ methods.</span></span>
<span id="cb3-14"><a></a><span class="co">    folds : int</span></span>
<span id="cb3-15"><a></a><span class="co">        Number of folds for cross-fitting</span></span>
<span id="cb3-16"><a></a></span>
<span id="cb3-17"><a></a><span class="co">    Returns</span></span>
<span id="cb3-18"><a></a><span class="co">    -------</span></span>
<span id="cb3-19"><a></a><span class="co">    ols : statsmodels regression results containing estimate of coefficient on d.</span></span>
<span id="cb3-20"><a></a><span class="co">    yhat : cross-fitted predictions of y</span></span>
<span id="cb3-21"><a></a><span class="co">    dhat : cross-fitted predictions of d</span></span>
<span id="cb3-22"><a></a><span class="co">    """</span></span>
<span id="cb3-23"><a></a></span>
<span id="cb3-24"><a></a>    <span class="co"># we want predicted probabilities if y or d is discrete</span></span>
<span id="cb3-25"><a></a>    ymethod <span class="op">=</span> <span class="st">"predict"</span> <span class="cf">if</span> <span class="va">False</span><span class="op">==</span><span class="bu">getattr</span>(yestimator, <span class="st">"predict_proba"</span>,<span class="va">False</span>) <span class="cf">else</span> <span class="st">"predict_proba"</span></span>
<span id="cb3-26"><a></a>    dmethod <span class="op">=</span> <span class="st">"predict"</span> <span class="cf">if</span> <span class="va">False</span><span class="op">==</span><span class="bu">getattr</span>(destimator, <span class="st">"predict_proba"</span>,<span class="va">False</span>) <span class="cf">else</span> <span class="st">"predict_proba"</span></span>
<span id="cb3-27"><a></a>    <span class="co"># get the predictions</span></span>
<span id="cb3-28"><a></a>    yhat <span class="op">=</span> cross_val_predict(yestimator,X,y,cv<span class="op">=</span>folds,method<span class="op">=</span>ymethod)</span>
<span id="cb3-29"><a></a>    dhat <span class="op">=</span> cross_val_predict(destimator,X,d,cv<span class="op">=</span>folds,method<span class="op">=</span>dmethod)</span>
<span id="cb3-30"><a></a>    ey <span class="op">=</span> np.array(y <span class="op">-</span> yhat)</span>
<span id="cb3-31"><a></a>    ed <span class="op">=</span> np.array(d <span class="op">-</span> dhat)</span>
<span id="cb3-32"><a></a>    ols <span class="op">=</span> sm.regression.linear_model.OLS(ey,ed).fit(cov_type<span class="op">=</span><span class="st">'HC0'</span>)</span>
<span id="cb3-33"><a></a></span>
<span id="cb3-34"><a></a>    <span class="cf">return</span>(ols, yhat, dhat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="unconditional-gap" class="slide level2">
<h2>Unconditional Gap</h2>
<div id="bf296b61" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a></a>cps[<span class="st">"female"</span>] <span class="op">=</span> (cps.sex<span class="op">==</span><span class="dv">2</span>)</span>
<span id="cb4-2"><a></a>cps[<span class="st">"log_earn"</span>] <span class="op">=</span> np.log(cps.earnwke)</span>
<span id="cb4-3"><a></a>cps.loc[np.isinf(cps.log_earn), <span class="st">"log_earn"</span>] <span class="op">=</span> np.nan</span>
<span id="cb4-4"><a></a>cps[<span class="st">"log_uhours"</span>] <span class="op">=</span> np.log(cps.uhourse)</span>
<span id="cb4-5"><a></a>cps.loc[np.isinf(cps.log_uhours), <span class="st">"log_uhours"</span>] <span class="op">=</span> np.nan</span>
<span id="cb4-6"><a></a>cps[<span class="st">"log_hourslw"</span>] <span class="op">=</span> np.log(cps.hourslw)</span>
<span id="cb4-7"><a></a>cps.loc[np.isinf(cps.log_hourslw),<span class="st">"log_hourslw"</span>] <span class="op">=</span> np.nan</span>
<span id="cb4-8"><a></a>cps[<span class="st">"log_wageu"</span>] <span class="op">=</span> cps.log_earn <span class="op">-</span> cps.log_uhours</span>
<span id="cb4-9"><a></a>cps[<span class="st">"log_wagelw"</span>] <span class="op">=</span> cps.log_earn <span class="op">-</span> cps.log_hourslw</span>
<span id="cb4-10"><a></a></span>
<span id="cb4-11"><a></a>lm <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb4-12"><a></a>lm.append(smf.ols(formula<span class="op">=</span><span class="st">"log_earn ~ female"</span>, data<span class="op">=</span>cps,</span>
<span id="cb4-13"><a></a>                  missing<span class="op">=</span><span class="st">"drop"</span>).fit(cov_type<span class="op">=</span><span class="st">'HC0'</span>))</span>
<span id="cb4-14"><a></a>lm.append( smf.ols(formula<span class="op">=</span><span class="st">"log_wageu ~ female"</span>, data<span class="op">=</span>cps,</span>
<span id="cb4-15"><a></a>                   missing<span class="op">=</span><span class="st">"drop"</span>).fit(cov_type<span class="op">=</span><span class="st">'HC0'</span>))</span>
<span id="cb4-16"><a></a>lm.append(smf.ols(formula<span class="op">=</span><span class="st">"log_wagelw ~ female"</span>, data<span class="op">=</span>cps,</span>
<span id="cb4-17"><a></a>                  missing<span class="op">=</span><span class="st">"drop"</span>).fit(cov_type<span class="op">=</span><span class="st">'HC0'</span>))</span>
<span id="cb4-18"><a></a>lm.append(smf.ols(formula<span class="op">=</span><span class="st">"log_earn ~ female + log_hourslw + log_uhours"</span>, data<span class="op">=</span>cps,</span>
<span id="cb4-19"><a></a>                  missing<span class="op">=</span><span class="st">"drop"</span>).fit(cov_type<span class="op">=</span><span class="st">'HC0'</span>))</span>
<span id="cb4-20"><a></a>summary_col(lm, stars<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="4">
<table class="simpletable caption-top" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td></td>
<td data-quarto-table-cell-role="th">log_earn I</td>
<td data-quarto-table-cell-role="th">log_wageu I</td>
<td data-quarto-table-cell-role="th">log_wagelw I</td>
<td data-quarto-table-cell-role="th">log_earn II</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Intercept</td>
<td>6.8607***</td>
<td>3.2022***</td>
<td>3.2366***</td>
<td>2.0104***</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th"></td>
<td>(0.0091)</td>
<td>(0.0080)</td>
<td>(0.0088)</td>
<td>(0.0945)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">female[T.True]</td>
<td>-0.2965***</td>
<td>-0.1729***</td>
<td>-0.1746***</td>
<td>-0.1363***</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th"></td>
<td>(0.0133)</td>
<td>(0.0112)</td>
<td>(0.0124)</td>
<td>(0.0115)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">log_hourslw</td>
<td></td>
<td></td>
<td></td>
<td>0.0227</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th"></td>
<td></td>
<td></td>
<td></td>
<td>(0.0223)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">log_uhours</td>
<td></td>
<td></td>
<td></td>
<td>1.3025***</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th"></td>
<td></td>
<td></td>
<td></td>
<td>(0.0372)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">R-squared</td>
<td>0.0323</td>
<td>0.0166</td>
<td>0.0136</td>
<td>0.3367</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">R-squared Adj.</td>
<td>0.0323</td>
<td>0.0165</td>
<td>0.0135</td>
<td>0.3366</td>
</tr>
</tbody>
</table>
<br>
Standard errors in parentheses.<br>
* p&lt;.1, ** p&lt;.05, ***p&lt;.01
</div>
</div>
</section>
<section id="adding-controls" class="slide level2">
<h2>Adding Controls</h2>
<div id="c1d4da95" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a></a><span class="im">from</span> patsy <span class="im">import</span> dmatrices</span>
<span id="cb5-2"><a></a>fmla  <span class="op">=</span> <span class="st">"log_earn + female ~ log_uhours + log_hourslw + I(age**2) + age + C(grade92) + C(race) + C(smsastat) + C(unionmme) + C(unioncov)"</span> <span class="co">#C(ind02) + C(occ2012)"</span></span>
<span id="cb5-3"><a></a>yd, X <span class="op">=</span> dmatrices(fmla,cps)</span>
<span id="cb5-4"><a></a>female <span class="op">=</span> yd[:,<span class="dv">1</span>]</span>
<span id="cb5-5"><a></a>logearn <span class="op">=</span> yd[:,<span class="dv">2</span>]<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="estimating-eta" class="slide level2">
<h2>Estimating <span class="math inline">\(\eta\)</span></h2>
<div id="ba539342" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a></a>alphas <span class="op">=</span> np.exp(np.linspace(<span class="op">-</span><span class="dv">2</span>, <span class="op">-</span><span class="dv">12</span>, <span class="dv">20</span>))</span>
<span id="cb6-2"><a></a>lassoy <span class="op">=</span> linear_model.LassoCV(cv<span class="op">=</span><span class="dv">4</span>, alphas<span class="op">=</span>alphas, max_iter<span class="op">=</span><span class="dv">5000</span>).fit(X,logearn)</span>
<span id="cb6-3"><a></a>lassod <span class="op">=</span> linear_model.LassoCV(cv<span class="op">=</span><span class="dv">4</span>, alphas<span class="op">=</span>alphas, max_iter<span class="op">=</span><span class="dv">5000</span>).fit(X,female)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="estimating-eta-1" class="slide level2">
<h2>Estimating <span class="math inline">\(\eta\)</span></h2>
<div id="5d041938" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb7-2"><a></a></span>
<span id="cb7-3"><a></a><span class="kw">def</span> plotlassocv(l, ax) :</span>
<span id="cb7-4"><a></a>    alphas <span class="op">=</span> l.alphas_</span>
<span id="cb7-5"><a></a>    mse <span class="op">=</span> l.mse_path_.mean(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb7-6"><a></a>    std_error <span class="op">=</span> l.mse_path_.std(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb7-7"><a></a>    ax.plot(alphas,mse)</span>
<span id="cb7-8"><a></a>    ax.fill_between(alphas, mse <span class="op">+</span> std_error, mse <span class="op">-</span> std_error, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb7-9"><a></a></span>
<span id="cb7-10"><a></a>    ax.set_ylabel(<span class="st">'MSE +/- std error'</span>)</span>
<span id="cb7-11"><a></a>    ax.set_xlabel(<span class="st">'alpha'</span>)</span>
<span id="cb7-12"><a></a>    ax.set_xlim([alphas[<span class="dv">0</span>], alphas[<span class="op">-</span><span class="dv">1</span>]])</span>
<span id="cb7-13"><a></a>    ax.set_xscale(<span class="st">"log"</span>)</span>
<span id="cb7-14"><a></a>    <span class="cf">return</span>(ax)</span>
<span id="cb7-15"><a></a></span>
<span id="cb7-16"><a></a>ax[<span class="dv">0</span>] <span class="op">=</span> plotlassocv(lassoy,ax[<span class="dv">0</span>])</span>
<span id="cb7-17"><a></a>ax[<span class="dv">0</span>].set_title(<span class="st">"MSE for log(earn)"</span>)</span>
<span id="cb7-18"><a></a>ax[<span class="dv">1</span>] <span class="op">=</span> plotlassocv(lassod,ax[<span class="dv">1</span>])</span>
<span id="cb7-19"><a></a>ax[<span class="dv">1</span>].set_title(<span class="st">"MSE for female"</span>)</span>
<span id="cb7-20"><a></a>fig.tight_layout()</span>
<span id="cb7-21"><a></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="doubleml_files/figure-revealjs/cell-8-output-1.png" width="950" height="468"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="estimating-eta-2" class="slide level2">
<h2>Estimating <span class="math inline">\(\eta\)</span></h2>
<div id="678d0b42" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a></a><span class="kw">def</span> pickalpha(lassocv) :</span>
<span id="cb8-2"><a></a>    <span class="co">#imin = np.argmin(lassocv.mse_path_.mean(axis=1))</span></span>
<span id="cb8-3"><a></a>    <span class="co">#msemin = lassocv.mse_path_.mean(axis=1)[imin]</span></span>
<span id="cb8-4"><a></a>    <span class="co">#se = lassocv.mse_path_.std(axis=1)[imin]</span></span>
<span id="cb8-5"><a></a>    <span class="co">#alpha= min([alpha for (alpha, mse) in zip(lassocv.alphas_, lassocv.mse_path_.mean(axis=1)) if mse&lt;msemin+se])</span></span>
<span id="cb8-6"><a></a>    alpha <span class="op">=</span> lassocv.alpha_</span>
<span id="cb8-7"><a></a>    <span class="cf">return</span>(alpha)</span>
<span id="cb8-8"><a></a></span>
<span id="cb8-9"><a></a>alphay <span class="op">=</span> pickalpha(lassoy)</span>
<span id="cb8-10"><a></a>alphad <span class="op">=</span> pickalpha(lassod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="estimate-theta" class="slide level2">
<h2>Estimate <span class="math inline">\(\theta\)</span></h2>
<div id="a42b3c49" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a></a>pl_lasso <span class="op">=</span> partial_linear(logearn, female, X,</span>
<span id="cb9-2"><a></a>                          linear_model.Lasso(alpha<span class="op">=</span>alphay),</span>
<span id="cb9-3"><a></a>                          linear_model.Lasso(alpha<span class="op">=</span>alphad))</span>
<span id="cb9-4"><a></a>pl_lasso[<span class="dv">0</span>].summary(slim<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<table class="simpletable caption-top" data-quarto-postprocess="true">
<caption>OLS Regression Results</caption>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Dep. Variable:</td>
<td>y</td>
<td data-quarto-table-cell-role="th">F-statistic:</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Model:</td>
<td>OLS</td>
<td data-quarto-table-cell-role="th">Prob (F-statistic):</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">No. Observations:</td>
<td>12038</td>
<td data-quarto-table-cell-role="th"></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Covariance Type:</td>
<td>HC0</td>
<td data-quarto-table-cell-role="th"></td>
</tr>
</tbody>
</table>


<table class="simpletable caption-top" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td></td>
<td data-quarto-table-cell-role="th">coef</td>
<td data-quarto-table-cell-role="th">std err</td>
<td data-quarto-table-cell-role="th">z</td>
<td data-quarto-table-cell-role="th">P&gt;|z|</td>
<td data-quarto-table-cell-role="th">[0.025</td>
<td data-quarto-table-cell-role="th">0.975]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">x1</td>
<td>-0.1868</td>
<td>0.011</td>
<td>-16.643</td>
<td>0.000</td>
<td>-0.209</td>
<td>-0.165</td>
</tr>
</tbody>
</table>
<br><br>Notes:<br>[1] R² is computed without centering (uncentered) since the model does not contain a constant.<br>[2] Standard Errors are heteroscedasticity robust (HC0)
</div>
</div>
</section>
<section id="examining-predictions" class="slide level2">
<h2>Examining Predictions</h2>
<div id="f43b4a6f" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb10-2"><a></a><span class="co"># Visualize predictions</span></span>
<span id="cb10-3"><a></a><span class="kw">def</span> preddf(pl):</span>
<span id="cb10-4"><a></a>    df <span class="op">=</span> pd.DataFrame({<span class="st">"logearn"</span>:logearn,</span>
<span id="cb10-5"><a></a>                       <span class="st">"predicted"</span>:pl[<span class="dv">1</span>],</span>
<span id="cb10-6"><a></a>                       <span class="st">"female"</span>:female,</span>
<span id="cb10-7"><a></a>                       <span class="st">"P(female|x)"</span>:pl[<span class="dv">2</span>]})</span>
<span id="cb10-8"><a></a>    <span class="cf">return</span>(df)</span>
<span id="cb10-9"><a></a></span>
<span id="cb10-10"><a></a><span class="kw">def</span> plotpredictions(df) :</span>
<span id="cb10-11"><a></a>    fig, ax <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb10-12"><a></a>    plt.figure()</span>
<span id="cb10-13"><a></a>    sns.scatterplot(x <span class="op">=</span> df.predicted, y <span class="op">=</span> df.logearn<span class="op">-</span>df.predicted, hue<span class="op">=</span>df.female, ax<span class="op">=</span>ax[<span class="dv">0</span>])</span>
<span id="cb10-14"><a></a>    ax[<span class="dv">0</span>].set_title(<span class="st">"Prediction Errors for Log Earnings"</span>)</span>
<span id="cb10-15"><a></a></span>
<span id="cb10-16"><a></a>    sns.histplot(df[<span class="st">"P(female|x)"</span>][df.female<span class="op">==</span><span class="dv">0</span>], kde <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb10-17"><a></a>                 label <span class="op">=</span> <span class="st">"Male"</span>, ax<span class="op">=</span>ax[<span class="dv">1</span>])</span>
<span id="cb10-18"><a></a>    sns.histplot(df[<span class="st">"P(female|x)"</span>][df.female<span class="op">==</span><span class="dv">1</span>], kde <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb10-19"><a></a>                 label <span class="op">=</span> <span class="st">"Female"</span>, ax<span class="op">=</span>ax[<span class="dv">1</span>])</span>
<span id="cb10-20"><a></a>    ax[<span class="dv">1</span>].set_title(<span class="st">'P(female|x)'</span>)</span>
<span id="cb10-21"><a></a>    <span class="cf">return</span>(fig)</span>
<span id="cb10-22"><a></a></span>
<span id="cb10-23"><a></a>fig<span class="op">=</span>plotpredictions(preddf(pl_lasso))</span>
<span id="cb10-24"><a></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="doubleml_files/figure-revealjs/cell-11-output-1.png" width="819" height="450"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 960x480 with 0 Axes&gt;</code></pre>
</div>
</div>
</section>
<section id="software" class="slide level2">
<h2>Software</h2>
<ul>
<li><a href="https://docs.doubleml.org/stable/index.html">doubleml</a></li>
<li><a href="https://econml.azurewebsites.net/spec/estimation/dml.html">econml</a></li>
</ul>
</section>
<section id="using-doubleml" class="slide level2">
<h2>Using <code>doubleml</code></h2>
<div id="00e6abb3" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a></a><span class="im">import</span> doubleml</span>
<span id="cb12-2"><a></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> PolynomialFeatures</span>
<span id="cb12-3"><a></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LassoCV, LogisticRegressionCV</span>
<span id="cb12-4"><a></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb12-5"><a></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline</span>
<span id="cb12-6"><a></a></span>
<span id="cb12-7"><a></a>dml_data <span class="op">=</span> doubleml.DoubleMLData.from_arrays(X,logearn,female)</span>
<span id="cb12-8"><a></a><span class="co"># Initialize learners</span></span>
<span id="cb12-9"><a></a>Cs <span class="op">=</span> <span class="fl">0.0001</span><span class="op">*</span>np.logspace(<span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">10</span>)</span>
<span id="cb12-10"><a></a>lasso <span class="op">=</span> make_pipeline(StandardScaler(), LassoCV(cv<span class="op">=</span><span class="dv">5</span>, max_iter<span class="op">=</span><span class="dv">10000</span>))</span>
<span id="cb12-11"><a></a>lasso_class <span class="op">=</span> make_pipeline(StandardScaler(),</span>
<span id="cb12-12"><a></a>                            LogisticRegressionCV(cv<span class="op">=</span><span class="dv">5</span>, penalty<span class="op">=</span><span class="st">'l1'</span>, solver<span class="op">=</span><span class="st">'liblinear'</span>,</span>
<span id="cb12-13"><a></a>                                                 Cs <span class="op">=</span> Cs, max_iter<span class="op">=</span><span class="dv">1000</span>))</span>
<span id="cb12-14"><a></a></span>
<span id="cb12-15"><a></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb12-16"><a></a>dml_plr_lasso <span class="op">=</span> doubleml.DoubleMLPLR(dml_data,</span>
<span id="cb12-17"><a></a>                                     ml_l <span class="op">=</span> lasso,</span>
<span id="cb12-18"><a></a>                                     ml_m <span class="op">=</span> lasso_class,</span>
<span id="cb12-19"><a></a>                                     n_folds <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb12-20"><a></a>dml_plr_lasso.fit(store_predictions<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-21"><a></a><span class="bu">print</span>(dml_plr_lasso.summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       coef   std err          t         P&gt;|t|     2.5 %   97.5 %
d -0.181669  0.011178 -16.252139  2.157063e-59 -0.203578 -0.15976</code></pre>
</div>
</div>
</section>
<section id="visualizing-predictions-lasso-logistic-lasso" class="slide level2">
<h2>Visualizing Predictions: Lasso &amp; Logistic Lasso</h2>
<div id="088f61a5" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a></a><span class="kw">def</span> dmlpreddf(dml_model):</span>
<span id="cb14-2"><a></a>    df<span class="op">=</span>pd.DataFrame({<span class="st">"logearn"</span>:logearn,</span>
<span id="cb14-3"><a></a>                     <span class="st">"predicted"</span>:dml_model.predictions[<span class="st">'ml_l'</span>].flatten(),</span>
<span id="cb14-4"><a></a>                     <span class="st">"female"</span>:female,</span>
<span id="cb14-5"><a></a>                     <span class="st">"P(female|x)"</span>:dml_model.predictions[<span class="st">'ml_m'</span>].flatten()})</span>
<span id="cb14-6"><a></a>    <span class="cf">return</span>(df)</span>
<span id="cb14-7"><a></a></span>
<span id="cb14-8"><a></a>plotpredictions(dmlpreddf(dml_plr_lasso)).show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="doubleml_files/figure-revealjs/cell-13-output-1.png" width="819" height="450"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 960x480 with 0 Axes&gt;</code></pre>
</div>
</div>
</section>
<section id="with-gradient-boosted-trees" class="slide level2">
<h2>With Gradient Boosted Trees</h2>
<div id="cdeb32e9" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a></a><span class="im">from</span> lightgbm <span class="im">import</span> LGBMClassifier, LGBMRegressor</span>
<span id="cb16-2"><a></a>ylearner <span class="op">=</span> LGBMRegressor(force_col_wise<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-3"><a></a>dlearner <span class="op">=</span> LGBMClassifier(force_col_wise<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-4"><a></a>dml_plr_gbt <span class="op">=</span> doubleml.DoubleMLPLR(dml_data, ylearner, dlearner)</span>
<span id="cb16-5"><a></a>dml_plr_gbt.fit(store_predictions<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-6"><a></a><span class="bu">print</span>(dml_plr_gbt.summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[LightGBM] [Info] Total Bins 292
[LightGBM] [Info] Number of data points in the train set: 9630, number of used features: 28
[LightGBM] [Info] Start training from score 6.719951
[LightGBM] [Info] Total Bins 290
[LightGBM] [Info] Number of data points in the train set: 9630, number of used features: 28
[LightGBM] [Info] Start training from score 6.715158
[LightGBM] [Info] Total Bins 292
[LightGBM] [Info] Number of data points in the train set: 9630, number of used features: 28
[LightGBM] [Info] Start training from score 6.719371
[LightGBM] [Info] Total Bins 289
[LightGBM] [Info] Number of data points in the train set: 9631, number of used features: 28
[LightGBM] [Info] Start training from score 6.719395
[LightGBM] [Info] Total Bins 289
[LightGBM] [Info] Number of data points in the train set: 9631, number of used features: 28
[LightGBM] [Info] Start training from score 6.714159
[LightGBM] [Info] Number of positive: 4711, number of negative: 4919
[LightGBM] [Info] Total Bins 292
[LightGBM] [Info] Number of data points in the train set: 9630, number of used features: 28
[LightGBM] [Info] [binary:BoostFromScore]: pavg=0.489200 -&gt; initscore=-0.043205
[LightGBM] [Info] Start training from score -0.043205
[LightGBM] [Info] Number of positive: 4647, number of negative: 4983
[LightGBM] [Info] Total Bins 290
[LightGBM] [Info] Number of data points in the train set: 9630, number of used features: 28
[LightGBM] [Info] [binary:BoostFromScore]: pavg=0.482555 -&gt; initscore=-0.069810
[LightGBM] [Info] Start training from score -0.069810
[LightGBM] [Info] Number of positive: 4701, number of negative: 4929
[LightGBM] [Info] Total Bins 292
[LightGBM] [Info] Number of data points in the train set: 9630, number of used features: 28
[LightGBM] [Info] [binary:BoostFromScore]: pavg=0.488162 -&gt; initscore=-0.047361
[LightGBM] [Info] Start training from score -0.047361
[LightGBM] [Info] Number of positive: 4678, number of negative: 4953
[LightGBM] [Info] Total Bins 289
[LightGBM] [Info] Number of data points in the train set: 9631, number of used features: 28
[LightGBM] [Info] [binary:BoostFromScore]: pavg=0.485723 -&gt; initscore=-0.057123
[LightGBM] [Info] Start training from score -0.057123
[LightGBM] [Info] Number of positive: 4703, number of negative: 4928
[LightGBM] [Info] Total Bins 289
[LightGBM] [Info] Number of data points in the train set: 9631, number of used features: 28
[LightGBM] [Info] [binary:BoostFromScore]: pavg=0.488319 -&gt; initscore=-0.046733
[LightGBM] [Info] Start training from score -0.046733
       coef   std err          t         P&gt;|t|     2.5 %    97.5 %
d -0.163842  0.011051 -14.826095  9.934713e-50 -0.185501 -0.142182</code></pre>
</div>
</div>
</section>
<section id="visualizing-predictions-trees" class="slide level2">
<h2>Visualizing Predictions: Trees</h2>
<div id="35f4fd53" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a></a>plotpredictions(dmlpreddf(dml_plr_gbt)).show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="doubleml_files/figure-revealjs/cell-15-output-1.png" width="819" height="450"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 960x480 with 0 Axes&gt;</code></pre>
</div>
</div>
</section>
<section id="interactive-regression-model" class="slide level2">
<h2>Interactive Regression Model</h2>
<ul>
<li>Similar to matching, the partially linear regression model can suffer from misspecification bias if the effect of <span class="math inline">\(D\)</span> varies with <span class="math inline">\(X\)</span></li>
<li>Interactive regression model: <span class="math display">\[
\begin{align*}
Y &amp; = g_0(D,X) + U \\
D &amp; = m_0(X) + V
\end{align*}
\]</span></li>
<li>Mechanics same as matching heterogeneous effects</li>
<li>Orthogonal moment condition is same as doubly robust matching</li>
</ul>
</section>
<section id="interactive-regression-model---lasso" class="slide level2">
<h2>Interactive Regression Model - Lasso</h2>
<div id="ae26df0e" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb20-2"><a></a>dml_irm_lasso <span class="op">=</span> doubleml.DoubleMLIRM(dml_data,</span>
<span id="cb20-3"><a></a>                                     ml_g <span class="op">=</span> lasso,</span>
<span id="cb20-4"><a></a>                                     ml_m <span class="op">=</span> lasso_class,</span>
<span id="cb20-5"><a></a>                                     trimming_threshold <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span id="cb20-6"><a></a>                                     n_folds <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb20-7"><a></a>dml_irm_lasso.fit()</span>
<span id="cb20-8"><a></a>dml_irm_lasso.summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">coef</th>
<th data-quarto-table-cell-role="th">std err</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">P&gt;|t|</th>
<th data-quarto-table-cell-role="th">2.5 %</th>
<th data-quarto-table-cell-role="th">97.5 %</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">d</td>
<td>-0.229206</td>
<td>0.03706</td>
<td>-6.184647</td>
<td>6.224143e-10</td>
<td>-0.301843</td>
<td>-0.156569</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="interactive-regression-model---trees" class="slide level2">
<h2>Interactive Regression Model - Trees</h2>
<div id="15dd66b8" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb21-2"><a></a>dml_irm_gbt <span class="op">=</span> doubleml.DoubleMLIRM(dml_data,</span>
<span id="cb21-3"><a></a>                                     ml_g <span class="op">=</span> ylearner,</span>
<span id="cb21-4"><a></a>                                     ml_m <span class="op">=</span> dlearner,</span>
<span id="cb21-5"><a></a>                                     trimming_threshold <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span id="cb21-6"><a></a>                                     n_folds <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb21-7"><a></a>dml_irm_gbt.fit()</span>
<span id="cb21-8"><a></a>dml_irm_gbt.summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[LightGBM] [Info] Total Bins 257
[LightGBM] [Info] Number of data points in the train set: 4119, number of used features: 25
[LightGBM] [Info] Start training from score 6.868347
[LightGBM] [Info] Total Bins 252
[LightGBM] [Info] Number of data points in the train set: 4118, number of used features: 23
[LightGBM] [Info] Start training from score 6.859271
[LightGBM] [Info] Total Bins 255
[LightGBM] [Info] Number of data points in the train set: 4119, number of used features: 24
[LightGBM] [Info] Start training from score 6.857057
[LightGBM] [Info] Total Bins 254
[LightGBM] [Info] Number of data points in the train set: 3906, number of used features: 22
[LightGBM] [Info] Start training from score 6.576155
[LightGBM] [Info] Total Bins 263
[LightGBM] [Info] Number of data points in the train set: 3907, number of used features: 24
[LightGBM] [Info] Start training from score 6.567823
[LightGBM] [Info] Total Bins 253
[LightGBM] [Info] Number of data points in the train set: 3907, number of used features: 21
[LightGBM] [Info] Start training from score 6.553555
[LightGBM] [Info] Number of positive: 3906, number of negative: 4119
[LightGBM] [Info] Total Bins 286
[LightGBM] [Info] Number of data points in the train set: 8025, number of used features: 28
[LightGBM] [Info] [binary:BoostFromScore]: pavg=0.486729 -&gt; initscore=-0.053097
[LightGBM] [Info] Start training from score -0.053097
[LightGBM] [Info] Number of positive: 3907, number of negative: 4118
[LightGBM] [Info] Total Bins 286
[LightGBM] [Info] Number of data points in the train set: 8025, number of used features: 28
[LightGBM] [Info] [binary:BoostFromScore]: pavg=0.486854 -&gt; initscore=-0.052598
[LightGBM] [Info] Start training from score -0.052598
[LightGBM] [Info] Number of positive: 3907, number of negative: 4119
[LightGBM] [Info] Total Bins 288
[LightGBM] [Info] Number of data points in the train set: 8026, number of used features: 28
[LightGBM] [Info] [binary:BoostFromScore]: pavg=0.486793 -&gt; initscore=-0.052841
[LightGBM] [Info] Start training from score -0.052841</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">coef</th>
<th data-quarto-table-cell-role="th">std err</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">P&gt;|t|</th>
<th data-quarto-table-cell-role="th">2.5 %</th>
<th data-quarto-table-cell-role="th">97.5 %</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">d</td>
<td>-0.159562</td>
<td>0.013846</td>
<td>-11.524304</td>
<td>9.951303e-31</td>
<td>-0.1867</td>
<td>-0.132425</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="sources-and-further-reading" class="slide level2">
<h2>Sources and Further Reading</h2>
<ul>
<li>These slides borrow heavily from <a href="https://schrimpf.github.io/NeuralNetworkEconomics.jl/ml-intro/">my notes on machine learning in economics</a></li>
<li>The example is from <a href="https://datascience.quantecon.org/applications/ml_in_economics.html#estimation-of-nuisance-functions">my chapter on machine learning in QuantEcon: DataScience</a></li>
<li><span class="citation" data-cites="chernozhukov2017">Chernozhukov et al. (<a href="#/references" role="doc-biblioref" onclick="">2017</a>)</span> : short introduction to main idea</li>
<li><span class="citation" data-cites="chernozhukov2018">Chernozhukov et al. (<a href="#/references" role="doc-biblioref" onclick="">2018</a>)</span> : underlying theory</li>
<li><span class="citation" data-cites="knaus2022">Knaus (<a href="#/references" role="doc-biblioref" onclick="">2022</a>)</span> : approachable review of DML for doubly robust matching</li>
</ul>
</section>
<section id="references" class="slide level2 smaller scrollable">
<h2>References</h2>

<div class="quarto-auto-generated-content">
<div class="footer footer-default">

</div>
</div>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-belloni2014" class="csl-entry" role="listitem">
Belloni, Alexandre, Victor Chernozhukov, and Christian Hansen. 2014. <span>“Inference on Treatment Effects After Selection Among High-Dimensional Controls†.”</span> <em>The Review of Economic Studies</em> 81 (2): 608–50. <a href="https://doi.org/10.1093/restud/rdt044">https://doi.org/10.1093/restud/rdt044</a>.
</div>
<div id="ref-chernozhukov2017" class="csl-entry" role="listitem">
Chernozhukov, Victor, Denis Chetverikov, Mert Demirer, Esther Duflo, Christian Hansen, and Whitney Newey. 2017. <span>“Double/Debiased/Neyman Machine Learning of Treatment Effects.”</span> <em>American Economic Review</em> 107 (5): 261–65. <a href="https://doi.org/10.1257/aer.p20171038">https://doi.org/10.1257/aer.p20171038</a>.
</div>
<div id="ref-chernozhukov2018" class="csl-entry" role="listitem">
Chernozhukov, Victor, Denis Chetverikov, Mert Demirer, Esther Duflo, Christian Hansen, Whitney Newey, and James Robins. 2018. <span>“Double/Debiased Machine Learning for Treatment and Structural Parameters.”</span> <em>The Econometrics Journal</em> 21 (1): C1–68. <a href="https://doi.org/10.1111/ectj.12097">https://doi.org/10.1111/ectj.12097</a>.
</div>
<div id="ref-chernozhukov2015" class="csl-entry" role="listitem">
Chernozhukov, Victor, Christian Hansen, and Martin Spindler. 2015. <span>“Valid Post-Selection and Post-Regularization Inference: An Elementary, General Approach.”</span> <em>Annual Review of Economics</em> 7 (1): 649–88. <a href="https://doi.org/10.1146/annurev-economics-012315-015826">https://doi.org/10.1146/annurev-economics-012315-015826</a>.
</div>
<div id="ref-knaus2022" class="csl-entry" role="listitem">
Knaus, Michael C. 2022. <span>“<span class="nocase">Double machine learning-based programme evaluation under unconfoundedness</span>.”</span> <em>The Econometrics Journal</em> 25 (3): 602–27. <a href="https://doi.org/10.1093/ectj/utac015">https://doi.org/10.1093/ectj/utac015</a>.
</div>
<div id="ref-hines2022" class="csl-entry" role="listitem">
Oliver Hines, Karla Diaz-Ordaz, Oliver Dukes, and Stijn Vansteelandt. 2022. <span>“Demystifying Statistical Learning Based on Efficient Influence Functions.”</span> <em>The American Statistician</em> 76 (3): 292–304. <a href="https://doi.org/10.1080/00031305.2021.2021984">https://doi.org/10.1080/00031305.2021.2021984</a>.
</div>
</div>
</section></section>

    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="site_libs/revealjs/plugin/search/search.js"></script>
  <script src="site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true,"theme":"whiteboard","boardmarkerWidth":2,"chalkWidth":2,"chalkEffect":0},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1600,

        height: 900,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        // Bounds for smallest/largest possible scale to apply to content
        minScale: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        // For code content inside modals, clipBoardJS needs to be initialized with a container option
        // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>