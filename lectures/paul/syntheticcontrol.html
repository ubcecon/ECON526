<!DOCTYPE html>
<html lang="en"><head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/tabby.min.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.5.57">

  <meta name="author" content="Paul Schrimpf">
  <title>ECON 526 – Synthetic Control</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
    /* CSS for citations */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
      margin-bottom: 0em;
    }
    .hanging-indent div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }  </style>
  <link rel="stylesheet" href="site_libs/revealjs/dist/theme/quarto.css">
  <link href="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="athelstan-lillooet.jpg" data-background-size="contain" class="quarto-title-block center">
  <h1 class="title">Synthetic Control</h1>
  <p class="subtitle">ECON526</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Paul Schrimpf 
</div>
        <p class="quarto-title-affiliation">
            University of British Columbia
          </p>
    </div>
</div>

</section><section id="TOC">
<nav role="doc-toc"> 
<h2 id="toc-title">Table of contents</h2>
<ul>
<li><a href="#/introduction" id="/toc-introduction">Introduction</a></li>
<li><a href="#/inference" id="/toc-inference">Inference</a></li>
<li><a href="#/scpi_pkg" id="/toc-scpi_pkg">scpi_pkg</a></li>
</ul>
</nav>
</section>
<section>
<section id="introduction" class="title-slide slide level1 center">
<h1>Introduction</h1>
<p><span class="math display">\[
\def\Er{{\mathrm{E}}}
\def\En{{\mathbb{E}_n}}
\def\cov{{\mathrm{Cov}}}
\def\var{{\mathrm{Var}}}
\def\R{{\mathbb{R}}}
\newcommand\norm[1]{\left\lVert#1\right\rVert}
\def\rank{{\mathrm{rank}}}
\newcommand{\inpr}{ \overset{p^*_{\scriptscriptstyle n}}{\longrightarrow}}
\def\inprob{{\,{\buildrel p \over \rightarrow}\,}}
\def\indist{\,{\buildrel d \over \rightarrow}\,}
\DeclareMathOperator*{\plim}{plim}
\]</span></p>
</section>
<section id="setup" class="slide level2">
<h2>Setup</h2>
<ul>
<li>1 treated unit, observed <span class="math inline">\(T_0\)</span> periods before treatment, <span class="math inline">\(T_1\)</span> periods after</li>
<li><span class="math inline">\(J\)</span> untreated units</li>
<li><span class="math inline">\(J\)</span>, <span class="math inline">\(T_0\)</span> moderate in size</li>
<li>Formalisation of comparative case study</li>
</ul>
</section>
<section id="example-california-tobacco-control-program" class="slide level2">
<h2>Example: California Tobacco Control Program</h2>
<ul>
<li>Code and copy of data from <span class="citation" data-cites="facure2022">Facure (<a href="#/references" role="doc-biblioref" onclick="">2022</a>)</span></li>
<li>Data used in <span class="citation" data-cites="abadie2010">Abadie, Diamond, and Hainmueller (<a href="#/references" role="doc-biblioref" onclick="">2010</a>)</span></li>
</ul>
<div id="47edb8da" class="cell" data-code-summry="imports" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a></a><span class="im">import</span> warnings</span>
<span id="cb1-2"><a></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb1-3"><a></a></span>
<span id="cb1-4"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-6"><a></a><span class="im">from</span> matplotlib <span class="im">import</span> style</span>
<span id="cb1-7"><a></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb1-8"><a></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-9"><a></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb1-10"><a></a></span>
<span id="cb1-11"><a></a><span class="co">#if 'ipykernel' in sys.modules:</span></span>
<span id="cb1-12"><a></a><span class="co">#    %matplotlib inline</span></span>
<span id="cb1-13"><a></a></span>
<span id="cb1-14"><a></a>pd.set_option(<span class="st">"display.max_columns"</span>, <span class="dv">20</span>)</span>
<span id="cb1-15"><a></a>style.use(<span class="st">"fivethirtyeight"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data-california-tobacco-control-program" class="slide level2">
<h2>Data: California Tobacco Control Program</h2>
<div id="2ce81d28" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a></a>cigar <span class="op">=</span> pd.read_csv(<span class="st">"data/smoking.csv"</span>)</span>
<span id="cb2-2"><a></a>cigar.query(<span class="st">"california"</span>).head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">state</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">cigsale</th>
<th data-quarto-table-cell-role="th">lnincome</th>
<th data-quarto-table-cell-role="th">beer</th>
<th data-quarto-table-cell-role="th">age15to24</th>
<th data-quarto-table-cell-role="th">retprice</th>
<th data-quarto-table-cell-role="th">california</th>
<th data-quarto-table-cell-role="th">after_treatment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">62</td>
<td>3</td>
<td>1970</td>
<td>123.000000</td>
<td>NaN</td>
<td>NaN</td>
<td>0.178158</td>
<td>38.799999</td>
<td>True</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">63</td>
<td>3</td>
<td>1971</td>
<td>121.000000</td>
<td>NaN</td>
<td>NaN</td>
<td>0.179296</td>
<td>39.700001</td>
<td>True</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">64</td>
<td>3</td>
<td>1972</td>
<td>123.500000</td>
<td>9.930814</td>
<td>NaN</td>
<td>0.180434</td>
<td>39.900002</td>
<td>True</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">65</td>
<td>3</td>
<td>1973</td>
<td>124.400002</td>
<td>9.955092</td>
<td>NaN</td>
<td>0.181572</td>
<td>39.900002</td>
<td>True</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">66</td>
<td>3</td>
<td>1974</td>
<td>126.699997</td>
<td>9.947999</td>
<td>NaN</td>
<td>0.182710</td>
<td>41.900002</td>
<td>True</td>
<td>False</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="cigarette-sales-trends" class="slide level2">
<h2>Cigarette Sales Trends</h2>
<div id="2f4fa270" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a></a>ax <span class="op">=</span> plt.subplot(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb3-2"><a></a><span class="cf">for</span> gdf <span class="kw">in</span> cigar.groupby(<span class="st">"state"</span>):</span>
<span id="cb3-3"><a></a>    ax.plot(gdf[<span class="dv">1</span>][<span class="st">'year'</span>],gdf[<span class="dv">1</span>][<span class="st">'cigsale'</span>], alpha<span class="op">=</span><span class="fl">0.2</span>, lw<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">"k"</span>)</span>
<span id="cb3-4"><a></a></span>
<span id="cb3-5"><a></a>ax.set_ylim(<span class="dv">40</span>, <span class="dv">150</span>)</span>
<span id="cb3-6"><a></a>ax.plot(cigar.query(<span class="st">"california"</span>)[<span class="st">'year'</span>], cigar.query(<span class="st">"california"</span>)[<span class="st">'cigsale'</span>], label<span class="op">=</span><span class="st">"California"</span>)</span>
<span id="cb3-7"><a></a>cigar.query(<span class="st">"not california"</span>).groupby(<span class="st">"year"</span>)[<span class="st">'cigsale'</span>].mean().plot(ax<span class="op">=</span>ax, label<span class="op">=</span><span class="st">"Mean Other States"</span>)</span>
<span id="cb3-8"><a></a></span>
<span id="cb3-9"><a></a>plt.vlines(x<span class="op">=</span><span class="dv">1988</span>, ymin<span class="op">=</span><span class="dv">40</span>, ymax<span class="op">=</span><span class="dv">140</span>, linestyle<span class="op">=</span><span class="st">":"</span>, lw<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">"Proposition 99"</span>)</span>
<span id="cb3-10"><a></a>plt.ylabel(<span class="st">"Per-capita cigarette sales (in packs)"</span>)</span>
<span id="cb3-11"><a></a>plt.legend()</span>
<span id="cb3-12"><a></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="syntheticcontrol_files/figure-revealjs/cell-4-output-1.png" width="922" height="458"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="which-comparison" class="slide level2">
<h2>Which Comparison?</h2>
<div>
<ul>
<li class="fragment">All states?</li>
<li class="fragment">States bordering California?</li>
<li class="fragment">States with similar characteristics? Which characteristics?</li>
</ul>
</div>
</section>
<section id="synthetic-control" class="slide level2">
<h2>Synthetic Control</h2>
<ul>
<li>Compare treated unit (California) to weighted average of untreated units</li>
<li>Weights chosen to make sythetic control close to California</li>
</ul>
</section>
<section id="synthetic-control-1" class="slide level2">
<h2>Synthetic Control</h2>
<ul>
<li>Potential outcomes <span class="math inline">\(Y_{it}(0), Y_{it}(1)\)</span></li>
<li>For <span class="math inline">\(t&gt;T_0\)</span>, estimate treatment effect on treated unit as <span class="math display">\[
\hat{\tau}_{1t} = Y_{1t} -
\underbrace{\sum_{j=2}^{J+1} \hat{w}_j Y_{jt}}_{\hat{Y}_{1t}(0)}
\]</span></li>
<li><span class="math inline">\(\hat{w}_j\)</span> chosen to make synthetic control close to treated unit in before treatment</li>
</ul>
</section>
<section id="variables-to-match" class="slide level2">
<h2>Variables to Match</h2>
<ul>
<li>Vector of pretreatment variables for treated unit <span class="math display">\[
\mathbf{X}_1 = \left(Y_{11}, \cdots Y_{1T_0}, z_{11}, \cdots, z_1K \right)^T
\]</span></li>
<li>Matrix of same variabels for untreated <span class="math display">\[
\mathbf{X}_0 = \begin{pmatrix}
Y_{21} &amp; \cdots &amp; Y_{2T_0} &amp; z_{21} &amp; \cdots &amp; z_{2K} \\
\vdots &amp;        &amp;          &amp;        &amp;        &amp; \vdots \\
Y_{J+1,1} &amp; \cdots &amp; Y_{J+1,T_0} &amp; z_{J+1,1} &amp; \cdots &amp; z_{J+1,K}
\end{pmatrix}^T
\]</span></li>
</ul>
</section>
<section id="weights" class="slide level2">
<h2>Weights</h2>
<ul>
<li>Weights minimize difference <span class="math display">\[
\begin{align*}
\hat{W} = &amp; \textrm{arg}\min_{W \in \R^J} \Vert \mathbf{X}_1 - \mathbf{X}_0 W \Vert_V \\
&amp; s.t. \sum_{j=2}^{J+1} w_j = 1 \\
&amp; \;\;\; 0 \leq w_j \leq 1 \;\; \forall j
\end{align*}
\]</span></li>
</ul>
<aside class="notes">
<ul>
<li><span class="math inline">\(\Vert x \Vert_V = x' V x\)</span> is a weighted norm. Choose <span class="math inline">\(V\)</span> to e.g.&nbsp;weight by inverse variance</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="computing-weights" class="slide level2">
<h2>Computing Weights</h2>
<div id="bebcbdf8" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a></a>features <span class="op">=</span> [<span class="st">"cigsale"</span>, <span class="st">"retprice"</span>]</span>
<span id="cb4-2"><a></a>inverted <span class="op">=</span> (cigar.query(<span class="st">"~after_treatment"</span>) <span class="co"># filter pre-intervention period</span></span>
<span id="cb4-3"><a></a>            .pivot(index<span class="op">=</span><span class="st">'state'</span>, columns<span class="op">=</span><span class="st">"year"</span>)[features] <span class="co"># make one column per year and one row per state</span></span>
<span id="cb4-4"><a></a>            .T) <span class="co"># flip the table to have one column per state</span></span>
<span id="cb4-5"><a></a>inverted.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">state</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
<th data-quarto-table-cell-role="th">10</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">30</th>
<th data-quarto-table-cell-role="th">31</th>
<th data-quarto-table-cell-role="th">32</th>
<th data-quarto-table-cell-role="th">33</th>
<th data-quarto-table-cell-role="th">34</th>
<th data-quarto-table-cell-role="th">35</th>
<th data-quarto-table-cell-role="th">36</th>
<th data-quarto-table-cell-role="th">37</th>
<th data-quarto-table-cell-role="th">38</th>
<th data-quarto-table-cell-role="th">39</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">cigsale</td>
<td data-quarto-table-cell-role="th">1970</td>
<td>89.800003</td>
<td>100.300003</td>
<td>123.000000</td>
<td>124.800003</td>
<td>120.000000</td>
<td>155.000000</td>
<td>109.900002</td>
<td>102.400002</td>
<td>124.800003</td>
<td>134.600006</td>
<td>...</td>
<td>103.599998</td>
<td>92.699997</td>
<td>99.800003</td>
<td>106.400002</td>
<td>65.500000</td>
<td>122.599998</td>
<td>124.300003</td>
<td>114.500000</td>
<td>106.400002</td>
<td>132.199997</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1971</td>
<td>95.400002</td>
<td>104.099998</td>
<td>121.000000</td>
<td>125.500000</td>
<td>117.599998</td>
<td>161.100006</td>
<td>115.699997</td>
<td>108.500000</td>
<td>125.599998</td>
<td>139.300003</td>
<td>...</td>
<td>115.000000</td>
<td>96.699997</td>
<td>106.300003</td>
<td>108.900002</td>
<td>67.699997</td>
<td>124.400002</td>
<td>128.399994</td>
<td>111.500000</td>
<td>105.400002</td>
<td>131.699997</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1972</td>
<td>101.099998</td>
<td>103.900002</td>
<td>123.500000</td>
<td>134.300003</td>
<td>110.800003</td>
<td>156.300003</td>
<td>117.000000</td>
<td>126.099998</td>
<td>126.599998</td>
<td>149.199997</td>
<td>...</td>
<td>118.699997</td>
<td>103.000000</td>
<td>111.500000</td>
<td>108.599998</td>
<td>71.300003</td>
<td>138.000000</td>
<td>137.000000</td>
<td>117.500000</td>
<td>108.800003</td>
<td>140.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1973</td>
<td>102.900002</td>
<td>108.000000</td>
<td>124.400002</td>
<td>137.899994</td>
<td>109.300003</td>
<td>154.699997</td>
<td>119.800003</td>
<td>121.800003</td>
<td>124.400002</td>
<td>156.000000</td>
<td>...</td>
<td>125.500000</td>
<td>103.500000</td>
<td>109.699997</td>
<td>110.400002</td>
<td>72.699997</td>
<td>146.800003</td>
<td>143.100006</td>
<td>116.599998</td>
<td>109.500000</td>
<td>141.199997</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1974</td>
<td>108.199997</td>
<td>109.699997</td>
<td>126.699997</td>
<td>132.800003</td>
<td>112.400002</td>
<td>151.300003</td>
<td>123.699997</td>
<td>125.599998</td>
<td>131.899994</td>
<td>159.600006</td>
<td>...</td>
<td>129.699997</td>
<td>108.400002</td>
<td>114.800003</td>
<td>114.699997</td>
<td>75.599998</td>
<td>151.800003</td>
<td>149.600006</td>
<td>119.900002</td>
<td>111.800003</td>
<td>145.800003</td>
</tr>
</tbody>
</table>

<p>5 rows × 39 columns</p>
</div>
</div>
</div>
</section>
<section id="computing-weights-1" class="slide level2">
<h2>Computing Weights</h2>
<div id="e935f5e2" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a></a><span class="im">from</span> scipy.optimize <span class="im">import</span> fmin_slsqp</span>
<span id="cb5-2"><a></a><span class="im">from</span> toolz <span class="im">import</span> <span class="bu">reduce</span>, partial</span>
<span id="cb5-3"><a></a></span>
<span id="cb5-4"><a></a>X1 <span class="op">=</span> inverted[<span class="dv">3</span>].values <span class="co"># state of california</span></span>
<span id="cb5-5"><a></a>X0 <span class="op">=</span> inverted.drop(columns<span class="op">=</span><span class="dv">3</span>).values  <span class="co"># other states</span></span>
<span id="cb5-6"><a></a></span>
<span id="cb5-7"><a></a><span class="kw">def</span> loss_w(W, X0, X1) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb5-8"><a></a>    <span class="cf">return</span> np.sqrt(np.mean((X1 <span class="op">-</span> X0.dot(W))<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb5-9"><a></a></span>
<span id="cb5-10"><a></a></span>
<span id="cb5-11"><a></a><span class="kw">def</span> get_w(X0, X1):</span>
<span id="cb5-12"><a></a>    w_start <span class="op">=</span> [<span class="dv">1</span><span class="op">/</span>X0.shape[<span class="dv">1</span>]]<span class="op">*</span>X0.shape[<span class="dv">1</span>]</span>
<span id="cb5-13"><a></a>    weights <span class="op">=</span> fmin_slsqp(partial(loss_w, X0<span class="op">=</span>X0, X1<span class="op">=</span>X1),</span>
<span id="cb5-14"><a></a>                         np.array(w_start),</span>
<span id="cb5-15"><a></a>                         f_eqcons<span class="op">=</span><span class="kw">lambda</span> x: np.<span class="bu">sum</span>(x) <span class="op">-</span> <span class="dv">1</span>,</span>
<span id="cb5-16"><a></a>                         bounds<span class="op">=</span>[(<span class="fl">0.0</span>, <span class="fl">1.0</span>)]<span class="op">*</span><span class="bu">len</span>(w_start),</span>
<span id="cb5-17"><a></a>                         disp<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-18"><a></a>    <span class="cf">return</span> weights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="examining-weights" class="slide level2">
<h2>Examining Weights</h2>
<ul>
<li>Weights tend to be sparse</li>
<li>Good idea to examine which untreated units get positive weight</li>
<li>Should look at state names, but the data does not have them, and the <code>state</code> variable is not FIPs code or any standard identifier</li>
</ul>
<div id="e90c7d6b" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a></a>calif_weights <span class="op">=</span> get_w(X0, X1)</span>
<span id="cb6-2"><a></a><span class="bu">print</span>(<span class="st">"Sum:"</span>, calif_weights.<span class="bu">sum</span>())</span>
<span id="cb6-3"><a></a>np.<span class="bu">round</span>(calif_weights, <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sum: 1.000000000000424</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>array([0.    , 0.    , 0.    , 0.0852, 0.    , 0.    , 0.    , 0.    ,
       0.    , 0.    , 0.    , 0.    , 0.    , 0.    , 0.    , 0.    ,
       0.    , 0.    , 0.    , 0.113 , 0.1051, 0.4566, 0.    , 0.    ,
       0.    , 0.    , 0.    , 0.    , 0.    , 0.    , 0.    , 0.    ,
       0.2401, 0.    , 0.    , 0.    , 0.    , 0.    ])</code></pre>
</div>
</div>
</section>
<section id="effect-of-california-tobacco-control-program" class="slide level2">
<h2>Effect of California Tobacco Control Program</h2>
<div id="f9bf225f" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a></a>calif_synth <span class="op">=</span> cigar.query(<span class="st">"~california"</span>).pivot(index<span class="op">=</span><span class="st">'year'</span>, columns<span class="op">=</span><span class="st">"state"</span>)[<span class="st">"cigsale"</span>].values.dot(calif_weights)</span>
<span id="cb9-2"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb9-3"><a></a>plt.plot(cigar.query(<span class="st">"california"</span>)[<span class="st">"year"</span>], cigar.query(<span class="st">"california"</span>)[<span class="st">"cigsale"</span>], label<span class="op">=</span><span class="st">"California"</span>)</span>
<span id="cb9-4"><a></a>plt.plot(cigar.query(<span class="st">"california"</span>)[<span class="st">"year"</span>], calif_synth, label<span class="op">=</span><span class="st">"Synthetic Control"</span>)</span>
<span id="cb9-5"><a></a>plt.vlines(x<span class="op">=</span><span class="dv">1988</span>, ymin<span class="op">=</span><span class="dv">40</span>, ymax<span class="op">=</span><span class="dv">140</span>, linestyle<span class="op">=</span><span class="st">":"</span>, lw<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">"Proposition 99"</span>)</span>
<span id="cb9-6"><a></a>plt.ylabel(<span class="st">"Per-capita cigarette sales (in packs)"</span>)</span>
<span id="cb9-7"><a></a>plt.legend()</span>
<span id="cb9-8"><a></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="syntheticcontrol_files/figure-revealjs/cell-8-output-1.png" width="922" height="509"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="when-does-this-work" class="slide level2">
<h2>When Does this Work?</h2>
<ul>
<li>If data generated by linear factor model: <span class="math display">\[
Y_{jt}(0) = \delta_t + \theta_t Z_j + \lambda_t \mu_j + \epsilon_{jt}
\]</span>
<ul>
<li>Observed <span class="math inline">\(Z_j\)</span></li>
<li>Unobserved<span class="math inline">\(\lambda_t\)</span>, <span class="math inline">\(\mu_j\)</span></li>
</ul></li>
<li>As <span class="math inline">\(T_0\)</span> increases or variance of <span class="math inline">\(\epsilon_{jt}\)</span> decreases, bias of <span class="math inline">\(\hat{\tau}_{it}\)</span> decreases
<ul>
<li>Needs <span class="math inline">\(\mathbf{X}_1 \approx \mathbf{X}_0 W\)</span></li>
</ul></li>
</ul>
</section>
<section id="choices" class="slide level2">
<h2>Choices</h2>
<div>
<ul>
<li class="fragment">Variables in <span class="math inline">\(\mathbf{X}\)</span> to match
<ul>
<li class="fragment">Fewer make eaiser to have <span class="math inline">\(\mathbf{X}_1 \approx \mathbf{X}_0 W\)</span></li>
<li class="fragment">But fewer make <span class="math inline">\(W\)</span> depend more on <span class="math inline">\(\epsilon\)</span></li>
</ul></li>
<li class="fragment">Set of untreated units to consider
<ul>
<li class="fragment">More units makes eaiser to have <span class="math inline">\(\mathbf{X}_1 \approx \mathbf{X}_0 W\)</span></li>
<li class="fragment">But risk of overfitting</li>
</ul></li>
</ul>
</div>
</section></section>
<section>
<section id="inference" class="title-slide slide level1 center">
<h1>Inference</h1>

</section>
<section id="inference-1" class="slide level2">
<h2>Inference</h2>
<ul>
<li>Estimator <span class="math display">\[
\hat{\tau}_{1t} = Y_{1t} -
\underbrace{\sum_{j=2}^{J+1} \hat{w}_j Y_{jt}}_{\hat{Y}_{1t}(0)}
\]</span>
<ul>
<li>single observation of <span class="math inline">\(Y_{1t}\)</span></li>
<li><span class="math inline">\(\hat{w}_j\)</span> depends on pre-treatment variables <span class="math inline">\(\underbrace{\mathbf{X}_1, \mathbf{X}_0}_{(J+1) \times (T_0 + K)}\)</span></li>
<li><span class="math inline">\(J\)</span> values of <span class="math inline">\(Y_{jt}\)</span></li>
</ul></li>
<li>Usual asymptotics not applicable</li>
</ul>
</section>
<section id="treatment-permutation" class="slide level2">
<h2>Treatment Permutation</h2>
<ul>
<li>Compute estimate pretending each of the <span class="math inline">\(J\)</span> untreated units were treated instead</li>
<li>Use as distribution of <span class="math inline">\(\hat{\tau}_{1t}\)</span> under <span class="math inline">\(H_0: \tau_{1t} = 0\)</span></li>
</ul>
</section>
<section id="treatment-permutation-1" class="slide level2">
<h2>Treatment Permutation</h2>
<div id="40457178" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a></a><span class="kw">def</span> synthetic_control(state: <span class="bu">int</span>, data: pd.DataFrame) <span class="op">-&gt;</span> np.array:</span>
<span id="cb10-2"><a></a>    features <span class="op">=</span> [<span class="st">"cigsale"</span>, <span class="st">"retprice"</span>]</span>
<span id="cb10-3"><a></a>    inverted <span class="op">=</span> (data.query(<span class="st">"~after_treatment"</span>)</span>
<span id="cb10-4"><a></a>                .pivot(index<span class="op">=</span><span class="st">'state'</span>, columns<span class="op">=</span><span class="st">"year"</span>)[features]</span>
<span id="cb10-5"><a></a>                .T)</span>
<span id="cb10-6"><a></a>    X1 <span class="op">=</span> inverted[state].values <span class="co"># treated</span></span>
<span id="cb10-7"><a></a>    X0 <span class="op">=</span> inverted.drop(columns<span class="op">=</span>state).values <span class="co"># donor pool</span></span>
<span id="cb10-8"><a></a></span>
<span id="cb10-9"><a></a>    weights <span class="op">=</span> get_w(X0, X1)</span>
<span id="cb10-10"><a></a>    synthetic <span class="op">=</span> (data.query(<span class="ss">f"~(state==</span><span class="sc">{</span>state<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb10-11"><a></a>                 .pivot(index<span class="op">=</span><span class="st">'year'</span>, columns<span class="op">=</span><span class="st">"state"</span>)[<span class="st">"cigsale"</span>]</span>
<span id="cb10-12"><a></a>                 .values.dot(weights))</span>
<span id="cb10-13"><a></a>    <span class="cf">return</span> (data</span>
<span id="cb10-14"><a></a>            .query(<span class="ss">f"state==</span><span class="sc">{</span>state<span class="sc">}</span><span class="ss">"</span>)[[<span class="st">"state"</span>, <span class="st">"year"</span>, <span class="st">"cigsale"</span>, <span class="st">"after_treatment"</span>]]</span>
<span id="cb10-15"><a></a>            .assign(synthetic<span class="op">=</span>synthetic))</span>
<span id="cb10-16"><a></a></span>
<span id="cb10-17"><a></a><span class="im">from</span> joblib <span class="im">import</span> Parallel, delayed</span>
<span id="cb10-18"><a></a></span>
<span id="cb10-19"><a></a>control_pool <span class="op">=</span> cigar[<span class="st">"state"</span>].unique()</span>
<span id="cb10-20"><a></a>parallel_fn <span class="op">=</span> delayed(partial(synthetic_control, data<span class="op">=</span>cigar))</span>
<span id="cb10-21"><a></a>synthetic_states <span class="op">=</span> Parallel(n_jobs<span class="op">=</span><span class="dv">20</span>)(parallel_fn(state) <span class="cf">for</span> state <span class="kw">in</span> control_pool)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="treatment-permutation-2" class="slide level2">
<h2>Treatment Permutation</h2>
<div id="bf327ade" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">7</span>))</span>
<span id="cb11-2"><a></a><span class="cf">for</span> state <span class="kw">in</span> synthetic_states:</span>
<span id="cb11-3"><a></a>    plt.plot(state[<span class="st">"year"</span>], state[<span class="st">"cigsale"</span>] <span class="op">-</span> state[<span class="st">"synthetic"</span>], color<span class="op">=</span><span class="st">"C5"</span>,alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb11-4"><a></a></span>
<span id="cb11-5"><a></a>plt.plot(cigar.query(<span class="st">"california"</span>)[<span class="st">"year"</span>], cigar.query(<span class="st">"california"</span>)[<span class="st">"cigsale"</span>] <span class="op">-</span> calif_synth,</span>
<span id="cb11-6"><a></a>        label<span class="op">=</span><span class="st">"California"</span>)<span class="op">;</span></span>
<span id="cb11-7"><a></a></span>
<span id="cb11-8"><a></a>plt.vlines(x<span class="op">=</span><span class="dv">1988</span>, ymin<span class="op">=-</span><span class="dv">50</span>, ymax<span class="op">=</span><span class="dv">120</span>, linestyle<span class="op">=</span><span class="st">":"</span>, lw<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">"Proposition 99"</span>)</span>
<span id="cb11-9"><a></a>plt.hlines(y<span class="op">=</span><span class="dv">0</span>, xmin<span class="op">=</span><span class="dv">1970</span>, xmax<span class="op">=</span><span class="dv">2000</span>, lw<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb11-10"><a></a>plt.ylabel(<span class="st">"Gap in per-capita cigarette sales (in packs)"</span>)</span>
<span id="cb11-11"><a></a>plt.title(<span class="st">"State - Synthetic Across Time"</span>)</span>
<span id="cb11-12"><a></a>plt.legend()</span>
<span id="cb11-13"><a></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="syntheticcontrol_files/figure-revealjs/cell-10-output-1.png" width="1092" height="615"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="treatment-permutation-inference" class="slide level2">
<h2>Treatment Permutation Inference</h2>
<div id="395b4f39" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a></a><span class="kw">def</span> pre_treatment_error(state):</span>
<span id="cb12-2"><a></a>    pre_treat_error <span class="op">=</span> (state.query(<span class="st">"~after_treatment"</span>)[<span class="st">"cigsale"</span>]</span>
<span id="cb12-3"><a></a>                       <span class="op">-</span> state.query(<span class="st">"~after_treatment"</span>)[<span class="st">"synthetic"</span>]) <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb12-4"><a></a>    <span class="cf">return</span> pre_treat_error.mean()</span>
<span id="cb12-5"><a></a></span>
<span id="cb12-6"><a></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">7</span>))</span>
<span id="cb12-7"><a></a><span class="cf">for</span> state <span class="kw">in</span> synthetic_states:</span>
<span id="cb12-8"><a></a></span>
<span id="cb12-9"><a></a>    <span class="co"># remove units with mean error above 80.</span></span>
<span id="cb12-10"><a></a>    <span class="cf">if</span> pre_treatment_error(state) <span class="op">&lt;</span> <span class="dv">80</span>:</span>
<span id="cb12-11"><a></a>        plt.plot(state[<span class="st">"year"</span>], state[<span class="st">"cigsale"</span>] <span class="op">-</span> state[<span class="st">"synthetic"</span>], color<span class="op">=</span><span class="st">"C5"</span>,alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb12-12"><a></a></span>
<span id="cb12-13"><a></a>plt.plot(cigar.query(<span class="st">"california"</span>)[<span class="st">"year"</span>], cigar.query(<span class="st">"california"</span>)[<span class="st">"cigsale"</span>] <span class="op">-</span> calif_synth,</span>
<span id="cb12-14"><a></a>        label<span class="op">=</span><span class="st">"California"</span>)<span class="op">;</span></span>
<span id="cb12-15"><a></a></span>
<span id="cb12-16"><a></a>plt.vlines(x<span class="op">=</span><span class="dv">1988</span>, ymin<span class="op">=-</span><span class="dv">50</span>, ymax<span class="op">=</span><span class="dv">120</span>, linestyle<span class="op">=</span><span class="st">":"</span>, lw<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">"Proposition 99"</span>)</span>
<span id="cb12-17"><a></a>plt.hlines(y<span class="op">=</span><span class="dv">0</span>, xmin<span class="op">=</span><span class="dv">1970</span>, xmax<span class="op">=</span><span class="dv">2000</span>, lw<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb12-18"><a></a>plt.ylabel(<span class="st">"Gap in per-capita cigarette sales (in packs)"</span>)</span>
<span id="cb12-19"><a></a>plt.title(<span class="st">"Distribution of Effects"</span>)</span>
<span id="cb12-20"><a></a>plt.title(<span class="st">"State - Synthetic Across Time (Large Pre-Treatment Errors Removed)"</span>)</span>
<span id="cb12-21"><a></a>plt.legend()</span>
<span id="cb12-22"><a></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="syntheticcontrol_files/figure-revealjs/cell-11-output-1.png" width="1092" height="615"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="treatment-permutation-inference-testing-h_0-tau0" class="slide level2">
<h2>Treatment Permutation Inference: Testing <span class="math inline">\(H_0: \tau=0\)</span></h2>
<div id="ffea4cc0" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a></a>calif_number <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb13-2"><a></a></span>
<span id="cb13-3"><a></a>effects <span class="op">=</span> [state.query(<span class="st">"year==2000"</span>).iloc[<span class="dv">0</span>][<span class="st">"cigsale"</span>] <span class="op">-</span> state.query(<span class="st">"year==2000"</span>).iloc[<span class="dv">0</span>][<span class="st">"synthetic"</span>]</span>
<span id="cb13-4"><a></a>           <span class="cf">for</span> state <span class="kw">in</span> synthetic_states</span>
<span id="cb13-5"><a></a>           <span class="cf">if</span> pre_treatment_error(state) <span class="op">&lt;</span> <span class="dv">80</span>] <span class="co"># filter out noise</span></span>
<span id="cb13-6"><a></a></span>
<span id="cb13-7"><a></a>calif_effect <span class="op">=</span> cigar.query(<span class="st">"california &amp; year==2000"</span>).iloc[<span class="dv">0</span>][<span class="st">"cigsale"</span>] <span class="op">-</span> calif_synth[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb13-8"><a></a></span>
<span id="cb13-9"><a></a><span class="bu">print</span>(<span class="st">"California Treatment Effect for the Year 2000:"</span>, calif_effect)</span>
<span id="cb13-10"><a></a>np.array(effects)</span>
<span id="cb13-11"><a></a></span>
<span id="cb13-12"><a></a>np.mean(np.array(effects) <span class="op">&lt;</span> calif_effect)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>California Treatment Effect for the Year 2000: -24.83015975607075</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>0.02857142857142857</code></pre>
</div>
</div>
</section>
<section id="design-based-inference" class="slide level2">
<h2>Design Based Inference</h2>
<div class="fragment">
<ul>
<li>Sampling based inference:
<ul>
<li>Specify data generating process (DGP)</li>
<li>Find distribution of estimator under repeated sampling of datasets from DGP</li>
</ul></li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Design based inference:
<ul>
<li>Condition on dataset you have</li>
<li>Randomness of estimator from random assignment of treatment</li>
<li>See <span class="citation" data-cites="aaiw2020">Abadie et al. (<a href="#/references" role="doc-biblioref" onclick="">2020</a>)</span> for more information</li>
</ul></li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Treatment permutation inference is design based inference assuming the treated unit was chosen uniformly at random from all units</li>
</ul>
</div>
</section>
<section id="design-based-treatment-permutation-inference" class="slide level2">
<h2>Design Based / Treatment Permutation Inference</h2>
<ul>
<li>Pros:
<ul>
<li>Easy to implement and explain</li>
<li>Intuitive appeal, similar to placebo tests</li>
<li>Minimal assumptions about DGP</li>
</ul></li>
<li>Cons:
<ul>
<li>Assumption about randomized treatment assignment is generally false</li>
<li>Needs modification to test hypotheses other than <span class="math inline">\(H_0: \tau=0\)</span> &amp; to construct confidence intervals</li>
</ul></li>
</ul>
</section>
<section id="prediction-intervals" class="slide level2">
<h2>Prediction Intervals</h2>
<ul>
<li>Estimation error is a prediction error <span class="math display">\[
\begin{align*}
\hat{\tau}_{1t} = &amp; Y_{1t} -
\underbrace{\hat{Y}_{1t}(0)}_{\text{prediction given $Y_{jt}, \mathbf{X}_0$}}
\\
= &amp;  \underbrace{Y_{1t}(1) - \color{grey}{Y_{1t}(0)}}_{\tau_{1t}} + \underbrace{\color{grey}{Y_{1t}(0)} - \hat{Y}_{1t}(0)}_{\text{prediction error}}
\end{align*}
\]</span></li>
</ul>
<div class="fragment">
<ul>
<li>Many statistical methods for calculating distribution of prediction error</li>
<li>Difficulties:
<ul>
<li>High-dimensional: number of weights comparable to number of observations and dimension of predictors</li>
<li>Moderate sample sizes</li>
</ul></li>
</ul>
</div>
</section>
<section id="prediction-intervals-1" class="slide level2">
<h2>Prediction Intervals</h2>
<ul>
<li>Modern approaches accomodate high-dimensionality and give non-asymptotic results</li>
<li><span class="citation" data-cites="cwz2021">Chernozhukov, Wüthrich, and Zhu (<a href="#/references" role="doc-biblioref" onclick="">2021</a>)</span> : construct prediction intervals by permuting residuals (conformal inference)</li>
<li><span class="citation" data-cites="cattaneo2021">Cattaneo, Feng, and Titiunik (<a href="#/references" role="doc-biblioref" onclick="">2021</a>)</span> : divide prediction error into two pieces: estimation of <span class="math inline">\(\hat{w}\)</span> and unpredictable randomness in <span class="math inline">\(Y_{1t}(0)\)</span></li>
</ul>
</section>
<section id="catteneo-feng-titiunik" class="slide level2">
<h2>Catteneo, Feng, &amp; Titiunik</h2>
<ul>
<li><p>Given coverage level <span class="math inline">\(\alpha\)</span>, gives interval <span class="math inline">\(\mathcal{I}_{1-\alpha}\)</span> such that <span class="math display">\[
P\left[ P\left(\tau_{1t} \in \mathcal{I}_{1-\alpha} | \mathbf{X}_0, \{y_{jt}\}_{j=1}^J\right) &gt; 1-\alpha-\epsilon(T_0) \right] &gt; 1 - \pi(T_0)
\]</span> where <span class="math inline">\(\epsilon(T_0) \to 0\)</span> and <span class="math inline">\(\pi(T_0) \to 0\)</span> as <span class="math inline">\(T_0 \to \infty\)</span></p></li>
<li><p>prediction error comes from</p>
<ol type="1">
<li>estimation of <span class="math inline">\(\hat{w}\)</span>, options refer to <code>u_</code> in <code>scpi_pkg</code></li>
<li>unobservable stochastic error in <span class="math inline">\(Y_{1t}(0)\)</span>, options begin with <code>e_</code> in <code>scpi_pkg</code></li>
</ol></li>
<li><p>valid under broad range of DGPs, but appropriate interval does depend on dependence of data over time, stationarity, assumptions about distribution of error given predictors</p></li>
</ul>
</section>
<section id="software" class="slide level2">
<h2>Software</h2>
<ul>
<li><a href="https://github.com/nppackages/scpi">scpi_pkg</a> recommended, created by leading econometricians</li>
<li><a href="https://github.com/sdfordham/pysyncon?tab=readme-ov-file">pysyncon</a> actively maintained, well-documented, but appears not popular</li>
<li><a href="https://github.com/microsoft/SparseSC">SpareSC</a> created by researchers at Microsoft, uses particular variant</li>
<li><a href="https://github.com/kwuthrich/scinference">scinference</a> R package accompanying <span class="citation" data-cites="cwz2021">Chernozhukov, Wüthrich, and Zhu (<a href="#/references" role="doc-biblioref" onclick="">2021</a>)</span></li>
</ul>
</section></section>
<section>
<section id="scpi_pkg" class="title-slide slide level1 center">
<h1>scpi_pkg</h1>

</section>
<section id="data-preparation" class="slide level2">
<h2>Data Preparation</h2>
<div id="451b8053" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a></a><span class="im">import</span> random</span>
<span id="cb16-2"><a></a><span class="im">from</span> scpi_pkg.scdata <span class="im">import</span> scdata</span>
<span id="cb16-3"><a></a><span class="im">from</span> scpi_pkg.scest <span class="im">import</span> scest</span>
<span id="cb16-4"><a></a><span class="im">from</span> scpi_pkg.scplot <span class="im">import</span> scplot</span>
<span id="cb16-5"><a></a>scdf <span class="op">=</span> scdata(df<span class="op">=</span>cigar, id_var<span class="op">=</span><span class="st">"state"</span>, time_var<span class="op">=</span><span class="st">"year"</span>, outcome_var<span class="op">=</span><span class="st">"cigsale"</span>,</span>
<span id="cb16-6"><a></a>              period_pre<span class="op">=</span>cigar.query(<span class="st">"not after_treatment"</span>).year.unique(),</span>
<span id="cb16-7"><a></a>              period_post<span class="op">=</span>cigar.query(<span class="st">"after_treatment"</span>).year.unique(),</span>
<span id="cb16-8"><a></a>              unit_tr<span class="op">=</span>calif_number,</span>
<span id="cb16-9"><a></a>              unit_co<span class="op">=</span>cigar.query(<span class="st">"not california"</span>).state.unique(),</span>
<span id="cb16-10"><a></a>              features<span class="op">=</span>[<span class="st">"cigsale"</span>,<span class="st">"retprice"</span>],</span>
<span id="cb16-11"><a></a>              cov_adj<span class="op">=</span><span class="va">None</span>, cointegrated_data<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb16-12"><a></a>              constant<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="point-estimation" class="slide level2">
<h2>Point Estimation</h2>
<div id="fc73d54c" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a></a>est_si <span class="op">=</span> scest(scdf, w_constr<span class="op">=</span>{<span class="st">'name'</span>: <span class="st">"simplex"</span>})</span>
<span id="cb17-2"><a></a><span class="bu">print</span>(est_si)</span>
<span id="cb17-3"><a></a>est_si2 <span class="op">=</span> scest(scdf, w_constr<span class="op">=</span>{<span class="st">'p'</span>: <span class="st">'L1'</span>, <span class="st">'dir'</span>: <span class="st">'=='</span>, <span class="st">'Q'</span>: <span class="dv">1</span>, <span class="st">'lb'</span>: <span class="dv">0</span>})</span>
<span id="cb17-4"><a></a><span class="bu">print</span>(est_si2)</span>
<span id="cb17-5"><a></a>scplot(est_si)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>-----------------------------------------------------------------------
Call: scest
Synthetic Control Estimation - Setup

Constraint Type:                                                simplex
Constraint Size (Q):                                                  1
Treated Unit:                                                         3
Size of the donor pool:                                              38
Features                                                              2
Pre-treatment period                                          1970-1988
Pre-treatment periods used in estimation per feature:
 Feature  Observations
 cigsale            19
retprice            19
Covariates used for adjustment per feature:
 Feature  Num of Covariates
 cigsale                  0
retprice                  0

Synthetic Control Estimation - Results

Active donors: 5

Coefficients:
                    Weights
Treated Unit Donor         
3            1        0.000
             10       0.000
             11       0.000
             12       0.000
             13       0.000
             14       0.000
             15       0.000
             16       0.000
             17       0.000
             18       0.000
             19       0.000
             2        0.000
             20       0.000
             21       0.113
             22       0.105
             23       0.457
             24       0.000
             25       0.000
             26       0.000
             27       0.000
             28       0.000
             29       0.000
             30       0.000
             31       0.000
             32       0.000
             33       0.000
             34       0.240
             35       0.000
             36       0.000
             37       0.000
             38       0.000
             39       0.000
             4        0.000
             5        0.085
             6        0.000
             7        0.000
             8        0.000
             9        0.000

-----------------------------------------------------------------------
Call: scest
Synthetic Control Estimation - Setup

Constraint Type:                                          user provided
Constraint Size (Q):                                                  1
Treated Unit:                                                         3
Size of the donor pool:                                              38
Features                                                              2
Pre-treatment period                                          1970-1988
Pre-treatment periods used in estimation per feature:
 Feature  Observations
 cigsale            19
retprice            19
Covariates used for adjustment per feature:
 Feature  Num of Covariates
 cigsale                  0
retprice                  0

Synthetic Control Estimation - Results

Active donors: 5

Coefficients:
                    Weights
Treated Unit Donor         
3            1        0.000
             10       0.000
             11       0.000
             12       0.000
             13       0.000
             14       0.000
             15       0.000
             16       0.000
             17       0.000
             18       0.000
             19       0.000
             2        0.000
             20       0.000
             21       0.113
             22       0.105
             23       0.457
             24       0.000
             25       0.000
             26       0.000
             27       0.000
             28       0.000
             29       0.000
             30       0.000
             31       0.000
             32       0.000
             33       0.000
             34       0.240
             35       0.000
             36       0.000
             37       0.000
             38       0.000
             39       0.000
             4        0.000
             5        0.085
             6        0.000
             7        0.000
             8        0.000
             9        0.000
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="syntheticcontrol_files/figure-revealjs/cell-14-output-2.png" width="640" height="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="inference-2" class="slide level2">
<h2>Inference</h2>
<div id="f1e4c143" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a></a><span class="im">from</span> scpi_pkg.scpi <span class="im">import</span> scpi</span>
<span id="cb19-2"><a></a><span class="im">import</span> random</span>
<span id="cb19-3"><a></a>w_constr <span class="op">=</span> {<span class="st">'name'</span>: <span class="st">'simplex'</span>, <span class="st">'Q'</span>: <span class="dv">1</span>}</span>
<span id="cb19-4"><a></a>u_missp <span class="op">=</span> <span class="va">True</span></span>
<span id="cb19-5"><a></a>u_sigma <span class="op">=</span> <span class="st">"HC1"</span></span>
<span id="cb19-6"><a></a>u_order <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb19-7"><a></a>u_lags <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb19-8"><a></a>e_method <span class="op">=</span> <span class="st">"gaussian"</span></span>
<span id="cb19-9"><a></a>e_order <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb19-10"><a></a>e_lags <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb19-11"><a></a>e_alpha <span class="op">=</span> <span class="fl">0.05</span></span>
<span id="cb19-12"><a></a>u_alpha <span class="op">=</span> <span class="fl">0.05</span></span>
<span id="cb19-13"><a></a>sims <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb19-14"><a></a>cores <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb19-15"><a></a></span>
<span id="cb19-16"><a></a>random.seed(<span class="dv">8894</span>)</span>
<span id="cb19-17"><a></a>result <span class="op">=</span> scpi(scdf, sims<span class="op">=</span>sims, w_constr<span class="op">=</span>w_constr, u_order<span class="op">=</span>u_order, u_lags<span class="op">=</span>u_lags,</span>
<span id="cb19-18"><a></a>              e_order<span class="op">=</span>e_order, e_lags<span class="op">=</span>e_lags, e_method<span class="op">=</span>e_method, u_missp<span class="op">=</span>u_missp,</span>
<span id="cb19-19"><a></a>              u_sigma<span class="op">=</span>u_sigma, cores<span class="op">=</span>cores, e_alpha<span class="op">=</span>e_alpha, u_alpha<span class="op">=</span>u_alpha)</span>
<span id="cb19-20"><a></a>scplot(result, e_out<span class="op">=</span><span class="va">True</span>, x_lab<span class="op">=</span><span class="st">"year"</span>, y_lab<span class="op">=</span><span class="st">"per-capita cigarette sales (in packs)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>-----------------------------------------------
Estimating Weights...
Quantifying Uncertainty
Maximum expected execution time: 2 minutes.
 

20/200 iterations completed (10%)
40/200 iterations completed (20%)
60/200 iterations completed (30%)
80/200 iterations completed (40%)
100/200 iterations completed (50%)
120/200 iterations completed (60%)
140/200 iterations completed (70%)
160/200 iterations completed (80%)
180/200 iterations completed (90%)
200/200 iterations completed (100%)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="syntheticcontrol_files/figure-revealjs/cell-15-output-2.png" width="640" height="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sources-and-further-reading" class="slide level2">
<h2>Sources and Further Reading</h2>
<ul>
<li>example code from <span class="citation" data-cites="facure2022">Facure (<a href="#/references" role="doc-biblioref" onclick="">2022</a>)</span> <a href="https://matheusfacure.github.io/python-causality-handbook/15-Synthetic-Control.html">chapter 15</a></li>
<li>notation and theory follows <span class="citation" data-cites="abadie2021">Abadie (<a href="#/references" role="doc-biblioref" onclick="">2021</a>)</span></li>
<li><span class="citation" data-cites="hk2021">Huntington-Klein (<a href="#/references" role="doc-biblioref" onclick="">2021</a>)</span> <a href="https://theeffectbook.net/ch-TheEdge.html#synthetic-control">chapter 21.2</a></li>
<li>More technical:
<ul>
<li><span class="citation" data-cites="cattaneo2022">Cattaneo et al. (<a href="#/references" role="doc-biblioref" onclick="">2022</a>)</span> user guide for <code>scpi_pkg</code></li>
<li><span class="citation" data-cites="abadie2010">Abadie, Diamond, and Hainmueller (<a href="#/references" role="doc-biblioref" onclick="">2010</a>)</span> important paper popularizing synthetic control and permutation inference</li>
<li><span class="citation" data-cites="ac2021">Abadie and Cattaneo (<a href="#/references" role="doc-biblioref" onclick="">2021</a>)</span> lists recent statistical advances in synthetic control</li>
</ul></li>
</ul>
</section>
<section id="references" class="slide level2 smaller scrollable">
<h2>References</h2>

<div class="quarto-auto-generated-content">
<div class="footer footer-default">

</div>
</div>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-abadie2021" class="csl-entry" role="listitem">
Abadie, Alberto. 2021. <span>“Using Synthetic Controls: Feasibility, Data Requirements, and Methodological Aspects.”</span> <em>Journal of Economic Literature</em> 59 (2): 391–425. <a href="https://doi.org/10.1257/jel.20191450">https://doi.org/10.1257/jel.20191450</a>.
</div>
<div id="ref-aaiw2020" class="csl-entry" role="listitem">
Abadie, Alberto, Susan Athey, Guido W. Imbens, and Jeffrey M. Wooldridge. 2020. <span>“Sampling-Based Versus Design-Based Uncertainty in Regression Analysis.”</span> <em>Econometrica</em> 88 (1): 265–96. https://doi.org/<a href="https://doi.org/10.3982/ECTA12675">https://doi.org/10.3982/ECTA12675</a>.
</div>
<div id="ref-ac2021" class="csl-entry" role="listitem">
Abadie, Alberto, and Matias D. Cattaneo. 2021. <span>“Introduction to the Special Section on Synthetic Control Methods.”</span> <em>Journal of the American Statistical Association</em> 116 (536): 1713–15. <a href="https://doi.org/10.1080/01621459.2021.2002600">https://doi.org/10.1080/01621459.2021.2002600</a>.
</div>
<div id="ref-abadie2010" class="csl-entry" role="listitem">
Abadie, Alberto, Alexis Diamond, and Jens Hainmueller. 2010. <span>“Synthetic Control Methods for Comparative Case Studies: Estimating the Effect of California’s Tobacco Control Program.”</span> <em>Journal of the American Statistical Association</em> 105 (490): 493–505. <a href="https://doi.org/10.1198/jasa.2009.ap08746">https://doi.org/10.1198/jasa.2009.ap08746</a>.
</div>
<div id="ref-cattaneo2022" class="csl-entry" role="listitem">
Cattaneo, Matias D., Yingjie Feng, Filippo Palomba, and Rocio Titiunik. 2022. <span>“Scpi: Uncertainty Quantification for Synthetic Control Methods.”</span>
</div>
<div id="ref-cattaneo2021" class="csl-entry" role="listitem">
Cattaneo, Matias D., Yingjie Feng, and Rocio Titiunik. 2021. <span>“Prediction Intervals for Synthetic Control Methods.”</span> <em>Journal of the American Statistical Association</em> 116 (536): 1865–80. <a href="https://doi.org/10.1080/01621459.2021.1979561">https://doi.org/10.1080/01621459.2021.1979561</a>.
</div>
<div id="ref-cwz2021" class="csl-entry" role="listitem">
Chernozhukov, Victor, Kaspar Wüthrich, and Yinchu Zhu. 2021. <span>“An Exact and Robust Conformal Inference Method for Counterfactual and Synthetic Controls.”</span> <em>Journal of the American Statistical Association</em> 116 (536): 1849–64. <a href="https://doi.org/10.1080/01621459.2021.1920957">https://doi.org/10.1080/01621459.2021.1920957</a>.
</div>
<div id="ref-facure2022" class="csl-entry" role="listitem">
Facure, Matheus. 2022. <em>Causal Inference for the Brave and True</em>. <a href="https://matheusfacure.github.io/python-causality-handbook/landing-page.html">https://matheusfacure.github.io/python-causality-handbook/landing-page.html</a>.
</div>
<div id="ref-hk2021" class="csl-entry" role="listitem">
Huntington-Klein, Nick. 2021. <em>The Effect: An Introduction to Research Design and Causality</em>. CRC Press. <a href="https://theeffectbook.net/">https://theeffectbook.net/</a>.
</div>
</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="site_libs/revealjs/plugin/search/search.js"></script>
  <script src="site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true,"theme":"whiteboard","boardmarkerWidth":2,"chalkWidth":2,"chalkEffect":0},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1600,

        height: 900,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        // Bounds for smallest/largest possible scale to apply to content
        minScale: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        // For code content inside modals, clipBoardJS needs to be initialized with a container option
        // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>